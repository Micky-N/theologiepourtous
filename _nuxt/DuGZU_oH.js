import{z as j,a0 as F,v as R,E as k,X as G,J as H,a4 as J,D as M,I as d,f as m,C as t,w as r,S as K,h as l,g as p,d as _,K as x,P as X,F as w,O as Y,t as $,N as Q,av as W,Y as Z,a6 as ee,e as s}from"#entry";import{_ as te,a as se}from"./ChfH4k70.js";import{_ as ae,a as oe,b as ne}from"./DAZbsBie.js";import{s as re,v as le}from"./ChZFRpQR.js";import{u as h}from"./BeoGUvjE.js";import{q as ie,b as ce}from"./UMFkJPit.js";import"./BZ1cZxcN.js";import"./iik6CYzq.js";import"./BOnxjY3A.js";const ue=["src"],de={class:"flex flex-col lg:flex-row items-start lg:items-center space-x-1"},me={class:"text-muted"},pe={key:0},_e={class:"flex flex-col md:flex-row md:items-center gap-2 mt-4"},fe={key:0,class:"text-sm font-medium text-muted"},ge={class:"flex flex-wrap items-center gap-2"},Te=j({__name:"[slug]",async setup(he){let o,f;const{loggedIn:C}=F(),i=R(),{data:e}=([o,f]=k(()=>h(i.path,()=>ie("lessons").path(i.path).first(),"$jlyxFBwIyO")),o=await o,f(),o);if(!e.value)throw G({statusCode:404,statusMessage:"Lesson not found",fatal:!0});const{data:v,refresh:S,status:b}=h(i.path+"-progress",()=>$fetch(`/api/teaching/progress/${e.value?.theme}`,{method:"GET"}),{immediate:C.value,server:!1}),{data:T}=([o,f]=k(()=>h("bible-books",()=>$fetch("/api/bible/books",{method:"GET"}))),o=await o,f(),o),{data:y}=h(`${i.path}-surround`,()=>ce("lessons",i.path,{fields:["description"]}).where("theme","=",i.params.theme)),U=c=>{if(!v.value?.data)return!1;const a=v.value?.data.lessons;if(!a)return!1;const u=JSON.parse(a);return u.length&&u.includes(c)},B=async c=>{try{await $fetch(`/api/teaching/progress/${e.value?.theme}`,{method:"POST",body:{lesson:c}}),await S()}catch(a){console.log(a)}};re(T.value?.data.all||[]);const D=c=>le(c,!0);H({title:e.value.title,description:e.value.seo.description,keywords:e.value.seo.keywords,author:"Théologie pour Tous",ogTitle:e.value.title,ogDescription:e.value.seo.description,ogImage:e.value.image.src,ogType:"article",ogUrl:e.value.seo.url,twitterCard:e.value.seo.card,twitterTitle:e.value.title,twitterDescription:e.value.seo.description,twitterImage:e.value.image.src}),J({htmlAttrs:{lang:e.value?.seo.lang||"fr"},link:[{rel:"canonical",href:e.value.seo.url}]});const g=M(()=>e.value&&U(e.value.slug)?{icon:"i-lucide-circle-check-big",color:"success",label:"Appris",variant:"subtle"}:v.value?.data?{icon:"i-lucide-circle-dashed",color:"secondary",label:"En cours",variant:"subtle"}:{icon:"i-lucide-flag",color:"warning",label:"Commencer le parcours",variant:"subtle"});return(c,a)=>{const u=X,P=Y,I=te,E=oe,N=Z,A=ne,V=se,q=ae,z=ee,L=K;return t(e)?(s(),d(L,{key:0},{default:r(()=>[l("img",{src:t(e).image.src,class:"w-full aspect-video rounded-b-xl max-h-[32rem] object-cover object-center"},null,8,ue),p(I,{title:t(e).title,description:t(e).description},{headline:r(()=>[l("div",de,[t(b)==="success"?(s(),d(u,{key:0,icon:t(g).icon,color:t(g).color,label:t(g).label,variant:t(g).variant,size:"xs",onClick:a[0]||(a[0]=n=>B(t(e).slug))},null,8,["icon","color","label","variant"])):["idle","pending"].includes(t(b))?(s(),d(u,{key:1,color:"secondary",variant:"subtle",size:"xs",disabled:""},{default:r(()=>[p(P,{name:"i-lucide-loader-2",class:"animate-spin"})]),_:1})):m("",!0),l("time",me,$(new Date(t(e).date).toLocaleDateString("fr",{year:"numeric",month:"long",day:"numeric"})),1),a[1]||(a[1]=l("span",{class:"hidden lg:block text-muted"},"·",-1)),l("div",null,[(s(!0),_(w,null,x(t(e).tags,(n,O)=>(s(),_("span",{key:n,class:"text-warning-600 font-light"},[Q($(n),1),O!==t(e).tags.length-1?(s(),_("span",pe,", ")):m("",!0)]))),128))])])]),default:r(()=>[l("div",_e,[t(e).biblical_references?.length?(s(),_("h3",fe," Références bibliques : ")):m("",!0),l("div",ge,[(s(!0),_(w,null,x(t(e).biblical_references,n=>(s(),d(u,{key:n,label:n,color:"secondary",variant:"subtle",size:"xs",to:D(n),target:"_blank"},null,8,["label","to"]))),128))])])]),_:1},8,["title","description"]),p(z,null,W({default:r(()=>[p(V,null,{default:r(()=>[t(e)?(s(),d(E,{key:0,value:t(e)},null,8,["value"])):m("",!0),t(y)?.length?(s(),d(N,{key:1})):m("",!0),p(A,{surround:t(y)},null,8,["surround"])]),_:1})]),_:2},[t(e)?.body?.toc?.links?.length?{name:"right",fn:r(()=>[p(q,{links:t(e).body.toc.links},null,8,["links"])]),key:"0"}:void 0]),1024)]),_:1})):m("",!0)}}});export{Te as default};
