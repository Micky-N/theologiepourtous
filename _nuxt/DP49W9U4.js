import{B as h,a5 as M,a6 as N,b2 as C,z as V,H as s,w as a,g as e,b5 as I,aW as q,R as z,L as j,e as b,r as y,b9 as U,C as $,d as G,I as H,f as k,F as O,aU as R,aV as W,P as Z,ba as D,M as J,E as K}from"#entry";import{_ as Q}from"./lF-cOGfW.js";import{_ as X,a as Y}from"./CVgFCWlT.js";import{_ as T}from"./CRu-j2f3.js";import{_ as B}from"./DM6w0mxt.js";import{o as E,s as v,b as S,n as ee}from"./D376FIhw.js";import{_ as se}from"./BD63mw3m.js";import"./9v54ouTo.js";const ne=h({__name:"SettingsGeneral",setup(t){const{user:n,fetch:i}=M(),c=N(),o=E({name:v().min(2,"Le nom doit contenir au moins 2 caractères"),email:v().email("Adresse mail invalide"),currentPassword:v().min(7).nullable(),newPassword:v().min(7,"Le mot de passe doit contenir au moins 7 caractères").regex(/(?=.*[a-z])/,"Le mot de passe doit contenir au moins une minuscule").regex(/(?=.*[A-Z])/,"Le mot de passe doit contenir au moins une majuscule").regex(/(?=.*\d)/,"Le mot de passe doit contenir au moins un chiffre").nullable(),confirmPassword:v().min(7).nullable()}).refine(d=>!d.newPassword||d.newPassword===d.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirm_password"]}),l=C({name:n.value?.name,email:n.value?.email,currentPassword:null,newPassword:null,confirmPassword:null}),w=async d=>{const{message:r}=await $fetch("/api/profile",{method:"PUT",body:d.data});c.add({title:"Succès",description:r,icon:"i-lucide-check",color:"success"}),await i()};return(d,r)=>{const m=q,p=I,_=z,P=T,g=j,x=B;return b(),V(x,{id:"general-settings",schema:s(o),state:s(l),onSubmit:w},{default:a(()=>[e(P,{variant:"subtle"},{default:a(()=>[e(p,{name:"name",label:"Nom",description:"Ce nom sera affiché publiquement sur votre profil",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:a(()=>[e(m,{modelValue:s(l).name,"onUpdate:modelValue":r[0]||(r[0]=u=>s(l).name=u),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(_),e(p,{name:"email",label:"Adresse e-mail",description:"Utilisée pour se connecter et recevoir des newsletters",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:a(()=>[e(m,{modelValue:s(l).email,"onUpdate:modelValue":r[1]||(r[1]=u=>s(l).email=u),type:"email",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(_),e(p,{name:"current_password",label:"Mot de passe actuel",description:"Entrez votre mot de passe actuel.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:a(()=>[e(m,{modelValue:s(l).currentPassword,"onUpdate:modelValue":r[2]||(r[2]=u=>s(l).currentPassword=u),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1}),e(_),e(p,{name:"new_password",label:"Nouveau mot de passe",description:"Entrez votre nouveau mot de passe.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:a(()=>[e(m,{modelValue:s(l).newPassword,"onUpdate:modelValue":r[3]||(r[3]=u=>s(l).newPassword=u),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1}),e(_),e(p,{name:"confirm_password",label:"Confirmez le mot de passe",description:"Confirmez votre nouveau mot de passe.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:a(()=>[e(m,{modelValue:s(l).confirmPassword,"onUpdate:modelValue":r[4]||(r[4]=u=>s(l).confirmPassword=u),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{label:"Enregistrer les modifications",color:"neutral",type:"submit",class:"w-fit lg:ms-auto mt-4"})]),_:1},8,["schema","state"])}}}),oe=Object.assign(ne,{__name:"SettingsGeneral"}),ae=()=>{const t=y({defaultVersionId:null,notesPerVersion:!1,bookmarksPerVersion:!1}),n=async c=>{const{data:o}=await $fetch("/api/preferences",{method:"PUT",body:c});t.value.defaultVersionId=o.defaultVersionId,t.value.notesPerVersion=o.notesPerVersion,t.value.bookmarksPerVersion=o.bookmarksPerVersion},i=async()=>{const{data:c}=await $fetch("/api/preferences",{method:"GET"});return t.value.defaultVersionId=c.defaultVersionId,t.value.notesPerVersion=c.notesPerVersion,t.value.bookmarksPerVersion=c.bookmarksPerVersion,t.value};return{preferences:U(t),updatePreferences:n,fetchPreferences:i}},te=()=>{const t=y([]),n=y(!1),i=y(null),c=async()=>{if(t.value.length>0)return t.value;n.value=!0,i.value=null;try{const o=await $fetch("/api/bible/versions");return t.value=o,o}catch(o){throw i.value=o instanceof Error?o.message:"Erreur lors de la récupération des versions",o}finally{n.value=!1}};return{versions:U(t),loading:U(n),error:U(i),fetchVersions:c}},re=h({__name:"SettingsPreferences",async setup(t){let n,i;const{preferences:c,updatePreferences:o,fetchPreferences:l}=ae(),{versions:w,fetchVersions:d}=te();[n,i]=$(()=>l()),await n,i(),[n,i]=$(()=>d()),await n,i();const r=E({defaultVersionId:ee().nullable(),notesPerVersion:S(),bookmarksPerVersion:S()}),m=C({defaultVersionId:c.value.defaultVersionId,notesPerVersion:c.value.notesPerVersion,bookmarksPerVersion:c.value.bookmarksPerVersion}),p=[{name:"defaultVersionId",label:"Version par défaut",description:"Version de la bible préférée",items:w.value},{name:"notesPerVersion",label:"Notes par version",description:"Afficher les notes par version"},{name:"bookmarksPerVersion",label:"Signets par version",description:"Afficher les signets par version"}];return(_,P)=>{const g=se,x=I,u=T,F=j,L=B;return b(),V(L,{id:"preferences",schema:s(r),state:s(m),onSubmit:P[0]||(P[0]=({data:f})=>s(o)(f))},{default:a(()=>[e(u,{variant:"subtle"},{default:a(()=>[(b(),G(O,null,H(p,f=>e(x,{key:f.name,name:f.name,label:f.label,description:f.description,class:"flex items-center justify-between not-last:pb-4 gap-2"},{default:a(()=>[f.name=="notesPerVersion"||f.name=="bookmarksPerVersion"?(b(),V(g,{key:0,modelValue:s(m)[f.name],"onUpdate:modelValue":A=>s(m)[f.name]=A},null,8,["modelValue","onUpdate:modelValue"])):k("",!0)]),_:2},1032,["name","label","description"])),64))]),_:1}),e(F,{form:"settings",label:"Save changes",color:"neutral",type:"submit",class:"w-fit lg:ms-auto mt-4"})]),_:1},8,["schema","state"])}}}),le=Object.assign(re,{__name:"SettingsPreferences"}),be=h({__name:"settings",setup(t){const n=y("general"),i=[{label:"Général",onSelect:()=>n.value="general"},{label:"Préférences",onSelect:()=>n.value="preferences"}];return R({title:"Paramètres",meta:[{name:"robots",content:"noindex,nofollow"},{name:"description",content:"Modifier les paramètres de votre compte"}]}),(c,o)=>{const l=D,w=Q,d=X,r=oe,m=le,p=Y,_=Z,P=K,g=W;return b(),V(g,null,{default:a(()=>[e(P,null,{default:a(()=>[e(_,null,{left:a(()=>[e(w,null,{top:a(()=>[...o[0]||(o[0]=[J(" Paramètres ",-1)])]),default:a(()=>[e(l,{items:i,highlight:"",orientation:"vertical"})]),_:1})]),default:a(()=>[e(d,{title:s(n)=="general"?"Profil":"Préférences",description:s(n)=="general"?"Modifier les informations de votre profil":"Modifier vos préférences utilisateur"},null,8,["title","description"]),e(p,null,{default:a(()=>[s(n)=="general"?(b(),V(r,{key:0})):k("",!0),s(n)=="preferences"?(b(),V(m,{key:1})):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}});export{be as default};
