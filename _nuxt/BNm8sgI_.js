import{z as T,a0 as R,a1 as F,ar as I,r as V,d as q,g as e,C as t,w as n,au as L,a8 as Y,Y as Z,P as G,ac as J,a7 as B,h as A,F as O,a3 as Q,e as g,aA as z,E as M,D as W,I as y,K as X,f as k,a4 as ee,a5 as se,a6 as te,aB as oe,N as ne,S as ae}from"#entry";import{_ as re}from"./B1bJNvZX.js";import{_ as le,a as ie}from"./ChfH4k70.js";import{_ as D}from"./C8liMDU-.js";import{_ as H}from"./XQVZmSxM.js";import{_ as ce}from"./Dh0plb8-.js";import{_ as me}from"./CvsAtPMi.js";import{o as K,s as x,b as N,n as ue}from"./D376FIhw.js";import{_ as de}from"./CiYoogra.js";import{_ as pe}from"./D_4Em1Od.js";import{u as fe}from"./vvHlCy_1.js";import"./BGeCMNnO.js";const _e={class:"space-y-4"},ve={class:"flex gap-3 justify-end"},be=T({__name:"SettingsGeneral",setup(w){const{user:a,fetch:l}=R(),d=F(),i=K({name:x().min(2,"Le nom doit contenir au moins 2 caractères"),email:x().email("Adresse mail invalide"),currentPassword:x().min(7).nullable(),newPassword:x().min(7,"Le mot de passe doit contenir au moins 7 caractères").regex(/(?=.*[a-z])/,"Le mot de passe doit contenir au moins une minuscule").regex(/(?=.*[A-Z])/,"Le mot de passe doit contenir au moins une majuscule").regex(/(?=.*\d)/,"Le mot de passe doit contenir au moins un chiffre").nullable(),confirmPassword:x().min(7).nullable()}).refine(m=>!m.newPassword||m.newPassword===m.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirm_password"]}),r=I({name:a.value?.name,email:a.value?.email,currentPassword:null,newPassword:null,confirmPassword:null}),U=async m=>{const{message:o}=await $fetch("/api/profile",{method:"PUT",body:m.data});d.add({title:"Succès",description:o,icon:"i-lucide-check",color:"success"}),await l()},p=V(!1),c=V(""),v=V(!1),f=async()=>{if(!c.value){d.add({title:"Erreur",description:"Veuillez entrer votre mot de passe",color:"error"});return}try{v.value=!0,await $fetch("/api/profile/delete-account",{method:"POST",body:{password:c.value}}),d.add({title:"Compte supprimé",description:"Votre compte a été supprimé avec succès",color:"success"}),await l(),await Q("/")}catch(m){d.add({title:"Erreur",description:m.data?.message||"Erreur lors de la suppression du compte",color:"error"})}finally{v.value=!1,p.value=!1,c.value=""}};return(m,o)=>{const _=Y,u=L,b=Z,h=D,P=G,S=H,$=ce,C=me,E=J;return g(),q(O,null,[e(S,{id:"general-settings",schema:t(i),state:t(r),onSubmit:U},{default:n(()=>[e(h,{variant:"subtle"},{default:n(()=>[e(u,{name:"name",label:"Nom",description:"Ce nom sera affiché publiquement sur votre profil",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:n(()=>[e(_,{modelValue:t(r).name,"onUpdate:modelValue":o[0]||(o[0]=s=>t(r).name=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(b),e(u,{name:"email",label:"Adresse e-mail",description:"Utilisée pour se connecter et recevoir des newsletters",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:n(()=>[e(_,{modelValue:t(r).email,"onUpdate:modelValue":o[1]||(o[1]=s=>t(r).email=s),type:"email",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(b),e(u,{name:"current_password",label:"Mot de passe actuel",description:"Entrez votre mot de passe actuel.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:n(()=>[e(_,{modelValue:t(r).currentPassword,"onUpdate:modelValue":o[2]||(o[2]=s=>t(r).currentPassword=s),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1}),e(b),e(u,{name:"new_password",label:"Nouveau mot de passe",description:"Entrez votre nouveau mot de passe.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:n(()=>[e(_,{modelValue:t(r).newPassword,"onUpdate:modelValue":o[3]||(o[3]=s=>t(r).newPassword=s),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1}),e(b),e(u,{name:"confirm_password",label:"Confirmez le mot de passe",description:"Confirmez votre nouveau mot de passe.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:n(()=>[e(_,{modelValue:t(r).confirmPassword,"onUpdate:modelValue":o[4]||(o[4]=s=>t(r).confirmPassword=s),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),e(P,{label:"Enregistrer les modifications",color:"neutral",type:"submit",class:"w-fit lg:ms-auto mt-4"})]),_:1},8,["schema","state"]),e(h,{title:"Suppression du compte",description:"Vous ne souhaitez plus utiliser notre service ? Vous pouvez supprimer votre compte ici. Cette action est irréversible. Toutes les informations liées à ce compte seront supprimées définitivement.",class:"bg-gradient-to-tl from-error/10 from-5% to-default"},{footer:n(()=>[e(P,{label:"Supprimer le compte",color:"error",onClick:o[5]||(o[5]=s=>p.value=!0)})]),_:1}),e(E,{open:t(p),"onUpdate:open":o[8]||(o[8]=s=>B(p)?p.value=s:null)},{content:n(()=>[e(C,null,{header:n(()=>[...o[9]||(o[9]=[A("h3",{class:"text-lg font-semibold text-error-600 dark:text-error-400"}," Supprimer définitivement votre compte ",-1)])]),footer:n(()=>[A("div",ve,[e(P,{label:"Annuler",color:"neutral",variant:"soft",disabled:t(v),onClick:o[7]||(o[7]=s=>p.value=!1)},null,8,["disabled"]),e(P,{label:"Supprimer définitivement",color:"error",loading:t(v),disabled:!t(c),onClick:f},null,8,["loading","disabled"])])]),default:n(()=>[A("div",_e,[e($,{color:"error",variant:"soft",title:"Attention !",description:"Cette action est irréversible. Toutes vos données (signets, notes, progrès) seront supprimées définitivement."}),e(u,{label:"Mot de passe",description:"Entrez votre mot de passe pour confirmer la suppression",required:""},{default:n(()=>[e(_,{modelValue:t(c),"onUpdate:modelValue":o[6]||(o[6]=s=>B(c)?c.value=s:null),type:"password",placeholder:"Entrez votre mot de passe",disabled:t(v)},null,8,["modelValue","disabled"])]),_:1})])]),_:1})]),_:1},8,["open"])],64)}}}),ge=Object.assign(be,{__name:"SettingsGeneral"}),we=()=>{const w=V([]),a=V(!1),l=V(null),d=async()=>{if(w.value.length>0)return w.value;a.value=!0,l.value=null;try{const i=await $fetch("/api/bible/versions");return w.value=i.data,i.data}catch(i){throw l.value=i instanceof Error?i.message:"Erreur lors de la récupération des versions",i}finally{a.value=!1}};return{versions:z(w),loading:z(a),error:z(l),fetchVersions:d}},Ve=T({__name:"SettingsPreferences",async setup(w){let a,l;const{preferences:d,updatePreferences:i,fetchPreferences:r}=fe(),{versions:U,fetchVersions:p}=we(),c=F();[a,l]=M(()=>r()),await a,l(),[a,l]=M(()=>p()),await a,l();const v=K({defaultVersionId:ue().nullable(),notesPerVersion:N(),bookmarksPerVersion:N()}),f=I({defaultVersionId:d.value.defaultVersionId,notesPerVersion:d.value.notesPerVersion,bookmarksPerVersion:d.value.bookmarksPerVersion}),m=W(()=>{const u=U.value.map(b=>({id:b.id,name:`${b.name} (${b.code})`}));return u.unshift({id:null,name:"Aucune"}),u}),o=async()=>{try{await i(f),await r(),c.add({title:"Succès",description:"Préférences mises à jour",icon:"i-lucide-check",color:"success"})}catch(u){c.add({title:"Erreur",description:u.message||"Une erreur est survenue",icon:"i-lucide-x-circle",color:"error"})}},_=[{name:"defaultVersionId",label:"Version par défaut",description:"Version de la bible préférée",items:m.value},{name:"notesPerVersion",label:"Notes par version",description:"Afficher les notes par version"},{name:"bookmarksPerVersion",label:"Signets par version",description:"Afficher les signets par version"}];return(u,b)=>{const h=de,P=pe,S=L,$=D,C=G,E=H;return g(),y(E,{id:"preferences",schema:t(v),state:t(f),onSubmit:o},{default:n(()=>[e($,{variant:"subtle"},{default:n(()=>[(g(),q(O,null,X(_,s=>e(S,{key:s.name,name:s.name,label:s.label,description:s.description,class:"flex items-center justify-between not-last:pb-4 gap-2"},{default:n(()=>[s.name=="notesPerVersion"||s.name=="bookmarksPerVersion"?(g(),y(h,{key:0,modelValue:t(f)[s.name],"onUpdate:modelValue":j=>t(f)[s.name]=j},null,8,["modelValue","onUpdate:modelValue"])):k("",!0),s.name=="defaultVersionId"&&s.items?(g(),y(P,{key:1,modelValue:t(f)[s.name],"onUpdate:modelValue":j=>t(f)[s.name]=j,items:s.items,"label-key":"name","value-key":"id",placeholder:"Sélectionner une version",class:"min-w-52"},null,8,["modelValue","onUpdate:modelValue","items"])):k("",!0)]),_:2},1032,["name","label","description"])),64))]),_:1}),e(C,{form:"preferences",label:"Enregistrer les préférences",color:"neutral",type:"submit",class:"w-fit lg:ms-auto mt-4"})]),_:1},8,["schema","state"])}}}),Pe=Object.assign(Ve,{__name:"SettingsPreferences"}),Te=T({__name:"settings",setup(w){const a=V("general"),l=[{label:"Général",onSelect:()=>a.value="general"},{label:"Préférences",onSelect:()=>a.value="preferences"}];return ee({title:"Paramètres",meta:[{name:"robots",content:"noindex,nofollow"},{name:"description",content:"Modifier les paramètres de votre compte"}]}),(d,i)=>{const r=oe,U=re,p=le,c=ge,v=Pe,f=ie,m=te,o=ae,_=se;return g(),y(_,null,{default:n(()=>[e(o,null,{default:n(()=>[e(m,null,{left:n(()=>[e(U,null,{top:n(()=>[...i[0]||(i[0]=[ne(" Paramètres ",-1)])]),default:n(()=>[e(r,{items:l,highlight:"",orientation:"vertical"})]),_:1})]),default:n(()=>[e(p,{title:t(a)=="general"?"Profil":"Préférences",description:t(a)=="general"?"Modifier les informations de votre profil":"Modifier vos préférences utilisateur"},null,8,["title","description"]),e(f,null,{default:n(()=>[t(a)=="general"?(g(),y(c,{key:0})):k("",!0),t(a)=="preferences"?(g(),y(v,{key:1})):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Te as default};
