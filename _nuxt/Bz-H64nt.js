import{B as T,a5 as R,a6 as Z,b2 as I,r as V,d as M,g as e,H as o,w as t,b5 as B,aW as D,R as J,L as F,aZ as W,J as j,h as C,F as L,a8 as K,e as g,b9 as $,C as z,z as k,I as Q,f as E,aU as X,aV as Y,P as ee,ba as se,M as oe,E as te}from"#entry";import{_ as ne}from"./lF-cOGfW.js";import{_ as ae,a as re}from"./CVgFCWlT.js";import{_ as N}from"./CRu-j2f3.js";import{_ as q}from"./DM6w0mxt.js";import{_ as le}from"./BOhgXgT6.js";import{_ as ie}from"./Bj6CTjPb.js";import{o as G,s as x,b as A,n as ce}from"./D376FIhw.js";import{_ as me}from"./BD63mw3m.js";import"./9v54ouTo.js";const ue={class:"space-y-4"},de={class:"flex gap-3 justify-end"},pe=T({__name:"SettingsGeneral",setup(l){const{user:n,fetch:i}=R(),a=Z(),r=G({name:x().min(2,"Le nom doit contenir au moins 2 caractères"),email:x().email("Adresse mail invalide"),currentPassword:x().min(7).nullable(),newPassword:x().min(7,"Le mot de passe doit contenir au moins 7 caractères").regex(/(?=.*[a-z])/,"Le mot de passe doit contenir au moins une minuscule").regex(/(?=.*[A-Z])/,"Le mot de passe doit contenir au moins une majuscule").regex(/(?=.*\d)/,"Le mot de passe doit contenir au moins un chiffre").nullable(),confirmPassword:x().min(7).nullable()}).refine(f=>!f.newPassword||f.newPassword===f.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirm_password"]}),c=I({name:n.value?.name,email:n.value?.email,currentPassword:null,newPassword:null,confirmPassword:null}),y=async f=>{const{message:s}=await $fetch("/api/profile",{method:"PUT",body:f.data});a.add({title:"Succès",description:s,icon:"i-lucide-check",color:"success"}),await i()},_=V(!1),d=V(""),p=V(!1),U=async()=>{if(!d.value){a.add({title:"Erreur",description:"Veuillez entrer votre mot de passe",color:"error"});return}try{p.value=!0,await $fetch("/api/profile/delete-account",{method:"POST",body:{password:d.value}}),a.add({title:"Compte supprimé",description:"Votre compte a été supprimé avec succès",color:"success"}),await i(),await K("/")}catch(f){a.add({title:"Erreur",description:f.data?.message||"Erreur lors de la suppression du compte",color:"error"})}finally{p.value=!1,_.value=!1,d.value=""}};return(f,s)=>{const v=D,b=B,w=J,h=N,P=F,u=q,S=le,H=ie,O=W;return g(),M(L,null,[e(u,{id:"general-settings",schema:o(r),state:o(c),onSubmit:y},{default:t(()=>[e(h,{variant:"subtle"},{default:t(()=>[e(b,{name:"name",label:"Nom",description:"Ce nom sera affiché publiquement sur votre profil",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:t(()=>[e(v,{modelValue:o(c).name,"onUpdate:modelValue":s[0]||(s[0]=m=>o(c).name=m),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(w),e(b,{name:"email",label:"Adresse e-mail",description:"Utilisée pour se connecter et recevoir des newsletters",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:t(()=>[e(v,{modelValue:o(c).email,"onUpdate:modelValue":s[1]||(s[1]=m=>o(c).email=m),type:"email",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(w),e(b,{name:"current_password",label:"Mot de passe actuel",description:"Entrez votre mot de passe actuel.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:t(()=>[e(v,{modelValue:o(c).currentPassword,"onUpdate:modelValue":s[2]||(s[2]=m=>o(c).currentPassword=m),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1}),e(w),e(b,{name:"new_password",label:"Nouveau mot de passe",description:"Entrez votre nouveau mot de passe.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:t(()=>[e(v,{modelValue:o(c).newPassword,"onUpdate:modelValue":s[3]||(s[3]=m=>o(c).newPassword=m),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1}),e(w),e(b,{name:"confirm_password",label:"Confirmez le mot de passe",description:"Confirmez votre nouveau mot de passe.",required:"",class:"flex max-sm:flex-col justify-between items-start gap-4"},{default:t(()=>[e(v,{modelValue:o(c).confirmPassword,"onUpdate:modelValue":s[4]||(s[4]=m=>o(c).confirmPassword=m),type:"password",placeholder:"********",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),e(P,{label:"Enregistrer les modifications",color:"neutral",type:"submit",class:"w-fit lg:ms-auto mt-4"})]),_:1},8,["schema","state"]),e(h,{title:"Suppression du compte",description:"Vous ne souhaitez plus utiliser notre service ? Vous pouvez supprimer votre compte ici. Cette action est irréversible. Toutes les informations liées à ce compte seront supprimées définitivement.",class:"bg-gradient-to-tl from-error/10 from-5% to-default"},{footer:t(()=>[e(P,{label:"Supprimer le compte",color:"error",onClick:s[5]||(s[5]=m=>_.value=!0)})]),_:1}),e(O,{open:o(_),"onUpdate:open":s[8]||(s[8]=m=>j(_)?_.value=m:null)},{content:t(()=>[e(H,null,{header:t(()=>[...s[9]||(s[9]=[C("h3",{class:"text-lg font-semibold text-error-600 dark:text-error-400"}," Supprimer définitivement votre compte ",-1)])]),footer:t(()=>[C("div",de,[e(P,{label:"Annuler",color:"neutral",variant:"soft",disabled:o(p),onClick:s[7]||(s[7]=m=>_.value=!1)},null,8,["disabled"]),e(P,{label:"Supprimer définitivement",color:"error",loading:o(p),disabled:!o(d),onClick:U},null,8,["loading","disabled"])])]),default:t(()=>[C("div",ue,[e(S,{color:"error",variant:"soft",title:"Attention !",description:"Cette action est irréversible. Toutes vos données (signets, notes, progrès) seront supprimées définitivement."}),e(b,{label:"Mot de passe",description:"Entrez votre mot de passe pour confirmer la suppression",required:""},{default:t(()=>[e(v,{modelValue:o(d),"onUpdate:modelValue":s[6]||(s[6]=m=>j(d)?d.value=m:null),type:"password",placeholder:"Entrez votre mot de passe",disabled:o(p)},null,8,["modelValue","disabled"])]),_:1})])]),_:1})]),_:1},8,["open"])],64)}}}),fe=Object.assign(pe,{__name:"SettingsGeneral"}),_e=()=>{const l=V({defaultVersionId:null,notesPerVersion:!1,bookmarksPerVersion:!1}),n=async a=>{const{data:r}=await $fetch("/api/preferences",{method:"PUT",body:a});l.value.defaultVersionId=r.defaultVersionId,l.value.notesPerVersion=r.notesPerVersion,l.value.bookmarksPerVersion=r.bookmarksPerVersion},i=async()=>{const{data:a}=await $fetch("/api/preferences",{method:"GET"});return l.value.defaultVersionId=a.defaultVersionId,l.value.notesPerVersion=a.notesPerVersion,l.value.bookmarksPerVersion=a.bookmarksPerVersion,l.value};return{preferences:$(l),updatePreferences:n,fetchPreferences:i}},ve=()=>{const l=V([]),n=V(!1),i=V(null),a=async()=>{if(l.value.length>0)return l.value;n.value=!0,i.value=null;try{const r=await $fetch("/api/bible/versions");return l.value=r,r}catch(r){throw i.value=r instanceof Error?r.message:"Erreur lors de la récupération des versions",r}finally{n.value=!1}};return{versions:$(l),loading:$(n),error:$(i),fetchVersions:a}},be=T({__name:"SettingsPreferences",async setup(l){let n,i;const{preferences:a,updatePreferences:r,fetchPreferences:c}=_e(),{versions:y,fetchVersions:_}=ve();[n,i]=z(()=>c()),await n,i(),[n,i]=z(()=>_()),await n,i();const d=G({defaultVersionId:ce().nullable(),notesPerVersion:A(),bookmarksPerVersion:A()}),p=I({defaultVersionId:a.value.defaultVersionId,notesPerVersion:a.value.notesPerVersion,bookmarksPerVersion:a.value.bookmarksPerVersion}),U=[{name:"defaultVersionId",label:"Version par défaut",description:"Version de la bible préférée",items:y.value},{name:"notesPerVersion",label:"Notes par version",description:"Afficher les notes par version"},{name:"bookmarksPerVersion",label:"Signets par version",description:"Afficher les signets par version"}];return(f,s)=>{const v=me,b=B,w=N,h=F,P=q;return g(),k(P,{id:"preferences",schema:o(d),state:o(p),onSubmit:s[0]||(s[0]=({data:u})=>o(r)(u))},{default:t(()=>[e(w,{variant:"subtle"},{default:t(()=>[(g(),M(L,null,Q(U,u=>e(b,{key:u.name,name:u.name,label:u.label,description:u.description,class:"flex items-center justify-between not-last:pb-4 gap-2"},{default:t(()=>[u.name=="notesPerVersion"||u.name=="bookmarksPerVersion"?(g(),k(v,{key:0,modelValue:o(p)[u.name],"onUpdate:modelValue":S=>o(p)[u.name]=S},null,8,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:2},1032,["name","label","description"])),64))]),_:1}),e(h,{form:"settings",label:"Save changes",color:"neutral",type:"submit",class:"w-fit lg:ms-auto mt-4"})]),_:1},8,["schema","state"])}}}),Ve=Object.assign(be,{__name:"SettingsPreferences"}),Ce=T({__name:"settings",setup(l){const n=V("general"),i=[{label:"Général",onSelect:()=>n.value="general"},{label:"Préférences",onSelect:()=>n.value="preferences"}];return X({title:"Paramètres",meta:[{name:"robots",content:"noindex,nofollow"},{name:"description",content:"Modifier les paramètres de votre compte"}]}),(a,r)=>{const c=se,y=ne,_=ae,d=fe,p=Ve,U=re,f=ee,s=te,v=Y;return g(),k(v,null,{default:t(()=>[e(s,null,{default:t(()=>[e(f,null,{left:t(()=>[e(y,null,{top:t(()=>[...r[0]||(r[0]=[oe(" Paramètres ",-1)])]),default:t(()=>[e(c,{items:i,highlight:"",orientation:"vertical"})]),_:1})]),default:t(()=>[e(_,{title:o(n)=="general"?"Profil":"Préférences",description:o(n)=="general"?"Modifier les informations de votre profil":"Modifier vos préférences utilisateur"},null,8,["title","description"]),e(U,null,{default:t(()=>[o(n)=="general"?(g(),k(d,{key:0})):E("",!0),o(n)=="preferences"?(g(),k(p,{key:1})):E("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Ce as default};
