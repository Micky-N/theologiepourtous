import{z as N,D as I,d as U,h as d,F as S,K as q,I as _,w as m,g,t as h,N as G,M as H,bD as K,C as r,e as i,v as W,a0 as Q,r as X,E as B,a3 as Y,J as Z,a6 as ee,L as te,U as se,f as x,n as ae,a7 as oe,S as ne}from"#entry";import{_ as re}from"./CvsAtPMi.js";import{_ as ie,a as ce}from"./SLxr-Eaq.js";import{_ as le}from"./DXub1hf0.js";import{_ as me}from"./3OpNAs3T.js";import{_ as ue}from"./CobAF68Z.js";import{u as v}from"./38kU-qnc.js";import{q as C}from"./CDftFpZ1.js";import{d as _e}from"./D8rO69WY.js";import"./-X3QHy90.js";const ge={class:"doctrine-tracker"},pe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},de={class:"space-y-3"},fe={class:"flex items-center justify-between"},he={class:"font-semibold"},ve={class:"text-sm text-gray-600"},ye=N({__name:"DoctrineProgress",props:{doctrines:{}},setup(p){const o=I(()=>p.doctrines.map(t=>({...t,progress:t.totalLessons?t.completedLessons/t.totalLessons*100:0}))),u=t=>t===100?"success":t>=50?"warning":"error";return(t,P)=>{const a=G,l=K,f=re;return i(),U("div",ge,[d("div",pe,[(i(!0),U(S,null,q(r(o),s=>(i(),_(f,{key:s.slug},{default:m(()=>[d("div",de,[d("div",fe,[d("h3",he,h(s.title),1),g(a,{color:u(s.progress)},{default:m(()=>[H(h(s.progress)+"% ",1)]),_:2},1032,["color"])]),g(l,{"model-value":s.progress},null,8,["model-value"]),d("div",ve,h(s.completedLessons)+" / "+h(s.totalLessons)+" leÃ§ons ",1)])]),_:2},1024))),128))])])}}}),Pe=Object.assign(ye,{__name:"DoctrineProgress"}),y=7,Ne=N({__name:"index",props:{themes:{}},async setup(p){let o,u;const t=W(),{loggedIn:P}=Q(),a=X(parseInt(t.query.page||"1")),{data:l}=([o,u]=B(()=>v("teaching",()=>C("teaching").first())),o=await o,u(),o),{data:f}=([o,u]=B(()=>v("lessons-count",()=>C("lessons").count())),o=await o,u(),o),{data:s}=v(t.path,()=>C("lessons").limit(y).skip((a.value-1)*y).all(),{watch:[a]}),{data:w}=v(t.path+"-progress",()=>$fetch("/api/teaching/progress",{method:"GET"}),{immediate:P.value,server:!1}),T=I(()=>w.value?.data?w.value.data.map(n=>({title:p.themes.find(c=>c.slug===n.theme)?.title||"",slug:n.theme,completedLessons:n.lessons?JSON.parse(n.lessons).length:0,totalLessons:s.value?.filter(c=>c.theme==n.theme).length||0})):[]),$=Math.ceil((f.value||0)/y);(a.value<1||t.query.page&&a.value===1||a.value>$)&&Y("/enseignements");const b=n=>n.id===s.value?.[0]?.id&&a.value===1,k=l.value?.seo?.title||l.value?.title,L=l.value?.seo?.description||l.value?.description;Z({title:k,ogTitle:k,description:L,ogDescription:L});const D=n=>p.themes.find(c=>c.path==="/enseignements/"+n.theme);return _e(),(n,c)=>{const j=te,F=Pe,O=ie,V=le,z=me,E=ue,M=ce,A=ne,J=ee;return i(),_(J,null,{default:m(()=>[g(j,{src:"/images/hero-blog.webp",class:"w-full aspect-video max-h-[32rem] object-center"}),g(A,null,{default:m(()=>[g(O,se(r(l),{class:"py-[50px]"}),{default:m(()=>[r(P)&&p.themes&&r(s)?(i(),_(F,{key:0,doctrines:r(T),class:"mt-4"},null,8,["doctrines"])):x("",!0)]),_:1},16),g(M,null,{default:m(()=>[r(s)?(i(),_(z,{key:0},{default:m(()=>[(i(!0),U(S,null,q(r(s),(e,R)=>(i(),_(V,{key:R,to:e.path,title:e.title,description:e.description,image:e.image,date:new Date(e.date).toLocaleDateString("fr",{year:"numeric",month:"long",day:"numeric"}),badge:{label:D(e)?.title,color:D(e)?.color||"primary"},orientation:b(e)?"horizontal":"vertical",class:ae([b(e)&&"col-span-full"]),variant:"naked",ui:{description:"line-clamp-2"}},null,8,["to","title","description","image","date","badge","orientation","class"]))),128))]),_:1})):x("",!0),r($)>1?(i(),_(E,{key:1,page:r(a),"onUpdate:page":c[0]||(c[0]=e=>oe(a)?a.value=e:null),"items-per-page":y,"show-edges":"",total:r(f),to:e=>({path:"/enseignements",query:e>1?{page:e}:{}}),class:"mt-10 flex justify-center"},null,8,["page","total","to"])):x("",!0)]),_:1})]),_:1})]),_:1})}}});export{Ne as default};
