import{z as te,r as m,a1 as oe,d as g,g as n,w as i,f as M,h as a,C as e,au as ae,a7 as B,F as H,K as J,n as G,I as K,t as v,P as le,O as ne,M as Q,ac as xe,e as d,_ as $e,J as Ce,v as Ve,a as we,E as Z,D as ee,a6 as Ue,av as Re,a8 as Se,ab as Be}from"#entry";import{_ as je}from"./B1bJNvZX.js";import{_ as ze,a as Ae}from"./SLxr-Eaq.js";import{_ as re}from"./Be_NR6f5.js";import{_ as ie}from"./DK0z5AdL.js";import{_ as de}from"./CvsAtPMi.js";import{_ as Ne}from"./BSJS_1nc.js";import{u as Le}from"./BDNIUN3_.js";import"./mbsasbvT.js";import"./CxfdSycM.js";import"./CZu05dKw.js";import"./BteGbDIr.js";const Me={class:"bible-comparison"},Ee={class:"flex items-center justify-between"},Oe={class:"text-xl font-bold text-gray-900 dark:text-white"},qe={key:0},Ie={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Pe={class:"flex gap-2"},Fe={key:0,class:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg"},Te={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},De={class:"flex items-center gap-2 pt-6"},Ge={class:"sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 pb-2 mb-4 z-10"},He={class:"flex items-center justify-between"},Je={class:"font-semibold text-gray-900 dark:text-white"},Ke={class:"text-xs text-gray-500 dark:text-gray-400"},Qe={class:"verses-container space-y-3"},We={class:"flex items-start gap-2"},Xe={key:0,class:"verse-number flex-shrink-0 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded-md min-w-[2rem] text-center"},Ye={class:"verse-actions opacity-0 group-hover:opacity-100 transition-opacity mt-2 flex gap-2"},Ze={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},es={class:"flex items-center justify-between"},ss={class:"flex gap-2"},ts={class:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400"},os={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},as=["onClick"],ls={class:"font-medium"},ns={class:"text-sm text-gray-500"},rs=te({__name:"BibleComparison",props:{book:{},chapter:{},verseRange:{},comparisons:{},availableVersions:{default:()=>[]},loading:{type:Boolean,default:!1}},emits:["close","addVersion","removeVersion","addBookmark","addNote"],setup(p,{emit:j}){const R=j,c=p,T=m(!1),z=m(!1),C=m("side-by-side"),b=m("normal"),V=m(!0),q=oe(),A=[{label:"Côte à côte",value:"side-by-side"},{label:"Vertical",value:"vertical"}],k=[{label:"Petit",value:"small"},{label:"Normal",value:"normal"},{label:"Grand",value:"large"},{label:"Très grand",value:"extra-large"}],x=y=>{c.comparisons.length<6&&(R("addVersion",y),z.value=!1)},w=y=>{R("removeVersion",y)},N=async(y,s)=>{const _=`${c.book.name} ${c.chapter}:${y.verse} (${s.code})
"${y.text}"`;try{await navigator.clipboard.writeText(_),q.add({title:"Verset copié",description:"Le verset a été copié dans le presse-papiers."})}catch(U){console.error("Erreur lors de la copie:",U),q.add({color:"error",title:"Erreur de copie",description:"Impossible de copier le verset."})}},u=()=>{const y=c.comparisons.map(E=>{const I=E.verses.map(P=>`${P.verse}. ${P.text}`).join(`
`);return`${E.version.name} (${E.version.code})
${I}`}).join(`

---

`),s=`${c.book.name} ${c.chapter}:${c.verseRange.start}${c.verseRange.end>c.verseRange.start?`-${c.verseRange.end}`:""}

${y}`,_=new Blob([s],{type:"text/plain"}),U=URL.createObjectURL(_),$=document.createElement("a");$.href=U,$.download=`${c.book.code}_${c.chapter}_${c.verseRange.start}-${c.verseRange.end}_comparison.txt`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(U)};return(y,s)=>{const _=le,U=re,$=ae,E=ie,I=ne,P=de,W=xe;return d(),g("div",Me,[n(P,null,{header:i(()=>[a("div",Ee,[a("div",null,[a("h2",Oe,[Q(" Comparaison : "+v(p.book.name)+" "+v(p.chapter)+":"+v(p.verseRange.start),1),p.verseRange.end>p.verseRange.start?(d(),g("span",qe,"-"+v(p.verseRange.end),1)):M("",!0)]),a("p",Ie,v(p.comparisons.length)+" versions côte à côte ",1)]),a("div",Pe,[n(_,{icon:"i-lucide-settings",variant:"ghost",size:"sm",onClick:s[0]||(s[0]=l=>T.value=!e(T))}),n(_,{icon:"i-lucide-x",variant:"ghost",size:"sm",onClick:s[1]||(s[1]=l=>y.$emit("close"))})])])]),footer:i(()=>[a("div",es,[a("div",ss,[n(_,{disabled:p.comparisons.length>=6,icon:"i-lucide-plus",label:"Ajouter version",variant:"outline",size:"sm",onClick:s[5]||(s[5]=l=>z.value=!0)},null,8,["disabled"]),n(_,{icon:"i-lucide-download",label:"Exporter",variant:"outline",size:"sm",onClick:u})]),a("div",ts,[p.loading?(d(),K(I,{key:0,name:"i-svg-spinners-3-dots-fade",class:"w-4 h-4 text-gray-400"})):M("",!0),s[10]||(s[10]=a("span",null,"Maximum 6 versions simultanées",-1))])])]),default:i(()=>[e(T)?(d(),g("div",Fe,[s[8]||(s[8]=a("h3",{class:"font-medium text-gray-900 dark:text-white mb-3"}," Options d'affichage ",-1)),a("div",Te,[n($,{label:"Layout"},{default:i(()=>[n(U,{modelValue:e(C),"onUpdate:modelValue":s[2]||(s[2]=l=>B(C)?C.value=l:null),items:A,"label-key":"label","value-key":"value"},null,8,["modelValue"])]),_:1}),n($,{label:"Taille du texte"},{default:i(()=>[n(U,{modelValue:e(b),"onUpdate:modelValue":s[3]||(s[3]=l=>B(b)?b.value=l:null),items:k,"label-key":"label","value-key":"value"},null,8,["modelValue"])]),_:1}),a("div",De,[n(E,{modelValue:e(V),"onUpdate:modelValue":s[4]||(s[4]=l=>B(V)?V.value=l:null),label:"Numéros de versets"},null,8,["modelValue"])])])])):M("",!0),a("div",{class:G(["grid gap-4",{"grid-cols-1":e(C)==="vertical","grid-cols-1 md:grid-cols-2":e(C)==="side-by-side"&&p.comparisons.length===2,"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":e(C)==="side-by-side"&&p.comparisons.length>=3}])},[(d(!0),g(H,null,J(p.comparisons,(l,O)=>(d(),g("div",{key:l.version.id,class:G(["version-column",{"!border-r-0 !pr-0":O!=0&&(O+1)%3===0,"border-r pr-4":O!=p.comparisons.length-1}])},[a("div",Ge,[a("div",He,[a("div",null,[a("h3",Je,v(l.version.name),1),a("p",Ke,v(l.version.code)+" • "+v(l.version.language),1)]),p.comparisons.length>2?(d(),K(_,{key:0,icon:"i-lucide-x",variant:"ghost",size:"xs",onClick:L=>w(l.version.id)},null,8,["onClick"])):M("",!0)])]),a("div",Qe,[(d(!0),g(H,null,J(l.verses,L=>(d(),g("div",{key:`${l.version.id}-${L.id}`,class:G(["group verse-item",e(b)])},[a("div",We,[e(V)?(d(),g("span",Xe,v(L.verse),1)):M("",!0),a("p",{class:G(["verse-text leading-relaxed text-gray-800 dark:text-gray-200",{"text-sm":e(b)==="small","text-base":e(b)==="normal","text-lg":e(b)==="large","text-xl":e(b)==="extra-large"}])},v(L.text),3)]),a("div",Ye,[n(_,{title:"Copier le verset",icon:"i-lucide-copy",variant:"ghost",size:"xs",onClick:se=>N(L,l.version)},null,8,["onClick"])])],2))),128))]),l.verses.length===0?(d(),g("div",Ze,[n(I,{name:"i-lucide-book-x",class:"w-8 h-8 mx-auto mb-2"}),s[9]||(s[9]=a("p",null," Aucun verset trouvé pour cette version ",-1))])):M("",!0)],2))),128))],2)]),_:1}),n(W,{open:e(z),"onUpdate:open":s[7]||(s[7]=l=>B(z)?z.value=l:null),title:"Ajouter une version",description:"Sélectionnez une version à ajouter à la comparaison"},{body:i(()=>[a("div",os,[(d(!0),g(H,null,J(p.availableVersions,l=>(d(),g("div",{key:l.id,class:"p-3 border border-gray-200 dark:border-gray-700 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",onClick:O=>x(l)},[a("div",ls,v(l.name),1),a("div",ns,v(l.code)+" • "+v(l.language),1)],8,as))),128))])]),footer:i(()=>[n(_,{label:"Annuler",variant:"ghost",onClick:s[6]||(s[6]=l=>z.value=!1)})]),_:1},8,["open"])])}}}),is=Object.assign($e(rs,[["__scopeId","data-v-f22e302a"]]),{__name:"BibleComparison"}),ds={key:0,class:"border-t dark:border-gray-800 pt-4"},cs={class:"space-y-1"},us={class:"truncate"},ms={class:"font-medium"},vs={class:"text-xs text-gray-500 dark:text-gray-400 ml-1"},ps={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bs={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},fs=["onClick"],ys={class:"flex items-center gap-3"},_s={class:"font-medium text-gray-900 dark:text-white"},hs={class:"text-xs text-gray-500 dark:text-gray-400"},ks={class:"flex items-center flex-row-reverse justify-between pt-4"},xs={key:1},Ls=te({__name:"compare",async setup(p){let j,R;Ce({title:"Comparaison de versions bibliques",ogTitle:"Comparaison de versions bibliques",description:"Comparez différentes versions de la Bible",ogDescription:"Comparez différentes versions de la Bible"});const c=Ve(),T=we(),{fetchPreferences:z,preferences:C}=Le();try{[j,R]=Z(()=>z()),await j,R()}catch(t){console.error("Erreur lors du chargement des préférences utilisateur",t)}const b=m([]),V=m(!1),q=m(!1),A=m(""),k=m(void 0),x=m(null),w=m(1),N=m(null),u=m([]),y=m([]),s=m(null),_=ee(()=>y.value.find(t=>t.code===k.value)),U=ee(()=>k.value&&x.value&&w.value&&u.value.length>=2&&u.value.length<=6),$=ee(()=>b.value.filter(t=>!s.value?.comparisons.some(o=>o.version.id===t.id))),E=()=>{const t=(c.query.verses||"").split("-");if(k.value=c.query.book||void 0,x.value=c.query.chapter?parseInt(c.query.chapter):null,w.value=t.length>0?parseInt(t[0]):1,N.value=t.length>1?parseInt(t[1]):null,b.value.length>0){const o=C.value?.defaultVersion?[C.value.defaultVersion.code,C.value?.defaultVersion.code==="LSG"?"S21":"LSG"]:["LSG","S21"],f=c.query.versions?.split(",")||o,h=b.value.filter(S=>f.includes(S.code)).map(S=>S.id);h.length>=2&&(u.value=h)}},I=(t,o)=>{o===!0?u.value.includes(t)||u.value.push(t):u.value=u.value.filter(h=>h!==t)},P=async()=>{try{q.value=!0;const t=await $fetch("/api/bible/books");y.value=t.data?.all}catch(t){A.value="Erreur lors du chargement des livres",console.error(t)}finally{q.value=!1}},W=async()=>{try{const t=await $fetch("/api/bible/versions");b.value=t.data||t}catch(t){A.value="Erreur lors du chargement des versions",console.error(t)}},l=async()=>{if(U.value)try{A.value="",V.value=!0;const t=_.value,o=x.value,f=w.value,h=N.value||f;if(!t){A.value="Veuillez sélectionner un livre";return}const S=await $fetch("/api/bible/compare",{method:"POST",body:{bookId:t.id,chapter:o,verseStart:f,verseEnd:h,versions:u.value}});s.value=S.data}catch(t){A.value=t?.message||"Erreur lors de la comparaison",console.error(t)}finally{V.value=!1}},O=async()=>{if(Object.keys(c.query).length>0)return await T.push("/bible/compare");s.value=null,k.value=void 0,x.value=null,u.value=b.value.filter(t=>["LSG","S21"].includes(t.code)).map(t=>t.id),w.value=1,N.value=null,A.value=""},L=async t=>{if(!s.value)return;const o={version:t,verses:[{id:0,chapter:s.value.chapter,verse:s.value.verseRange.start,text:"Chargement...",createdAt:new Date,versionId:t.id,bookId:s.value.book.id}]};s.value.comparisons.push(o),u.value.push(t.id),await l()},se=t=>{s.value&&(s.value.comparisons=s.value.comparisons.filter(o=>o.version.id!==t),u.value=u.value.filter(o=>o!==t))},ce=t=>{const o=oe();(async()=>{try{const f=await $fetch("/api/bible/bookmarks",{method:"POST",body:{verseId:t.id}});o.add({title:"Favori ajouté",description:f.message||"Le verset a été ajouté à vos favoris."}),s.value&&await l()}catch(f){const h=f?.statusCode||f?.response?.status,S=f?.statusMessage||f?.data?.message||f?.message;o.add({color:"error",title:h===401?"Connexion requise":"Erreur",description:h===409?"Ce verset est déjà dans vos favoris.":S||"Impossible d’ajouter le favori."})}})()},ue=t=>{X.value=t,F.value=!0},F=m(!1),X=m(null),me=async()=>{s.value&&await l()};return[j,R]=Z(()=>Promise.all([P(),W()])),await j,R(),E(),[j,R]=Z(()=>l()),await j,R(),(t,o)=>{const f=ne,h=le,S=je,ve=ze,pe=re,D=ae,Y=Se,ge=ie,be=de,fe=is,ye=Ae,_e=Ue,he=Ne;return d(),g("div",null,[n(_e,null,{left:i(()=>[n(S,null,{top:i(()=>[n(h,{to:"/bible",color:"secondary",variant:"ghost",class:"w-full justify-start mb-4"},{leading:i(()=>[n(f,{name:"i-lucide-arrow-left"})]),default:i(()=>[o[8]||(o[8]=Q(" Retour à la Bible ",-1))]),_:1}),e(s)?(d(),g("div",ds,[o[9]||(o[9]=a("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Versions disponibles ",-1)),a("div",cs,[(d(!0),g(H,null,J(e($),r=>(d(),K(h,{key:r.id,size:"sm",color:"secondary",variant:"soft",class:"w-full justify-start",disabled:e(V)||e(u).length===6,onClick:ke=>L(r)},{default:i(()=>[a("div",us,[a("span",ms,v(r.name),1),a("span",vs,"("+v(r.code)+")",1)])]),_:2},1032,["disabled","onClick"]))),128))])])):M("",!0)]),_:1})]),default:i(()=>[n(ve,{title:"Comparaison de versions bibliques",description:"Comparez différentes versions de la Bible sur un même passage."},Re({_:2},[e(s)?{name:"right",fn:i(()=>[n(h,{color:"secondary",variant:"ghost",icon:"i-lucide-x",onClick:o[0]||(o[0]=r=>O())},{default:i(()=>[...o[10]||(o[10]=[Q(" Fermer ",-1)])]),_:1})]),key:"0"}:void 0]),1024),n(ye,null,{default:i(()=>[e(s)?(d(),g("div",xs,[n(fe,{book:e(s).book,chapter:e(s).chapter,"verse-range":e(s).verseRange,comparisons:e(s).comparisons,"available-versions":e($),loading:e(V),onClose:O,onAddVersion:L,onRemoveVersion:se,onAddBookmark:ce,onAddNote:ue},null,8,["book","chapter","verse-range","comparisons","available-versions","loading"])])):(d(),K(be,{key:0},{header:i(()=>[...o[11]||(o[11]=[a("h3",{class:"text-lg font-medium"}," Sélectionner le passage à comparer ",-1)])]),default:i(()=>[a("form",{class:"space-y-6",onSubmit:Be(l,["prevent"])},[a("div",ps,[n(D,{label:"Livre"},{default:i(()=>[n(pe,{modelValue:e(k),"onUpdate:modelValue":o[1]||(o[1]=r=>B(k)?k.value=r:null),items:e(y),loading:e(q),"label-key":"name","value-key":"code",placeholder:"Sélectionner un livre",searchable:"","search-placeholder":"Rechercher un livre...",class:"max-w-52 w-full"},null,8,["modelValue","items","loading"])]),_:1}),n(D,{label:"Chapitre"},{default:i(()=>[n(Y,{modelValue:e(x),"onUpdate:modelValue":o[2]||(o[2]=r=>B(x)?x.value=r:null),modelModifiers:{number:!0},type:"number",min:"1",max:e(_)?.chapterCount||150,placeholder:"Numéro de chapitre",disabled:!e(k),class:"max-w-52 w-full"},null,8,["modelValue","max","disabled"])]),_:1})]),a("div",gs,[n(D,{label:"Verset de début"},{default:i(()=>[n(Y,{modelValue:e(w),"onUpdate:modelValue":o[3]||(o[3]=r=>B(w)?w.value=r:null),modelModifiers:{number:!0},type:"number",min:"1",placeholder:"1",disabled:!e(k)||!e(x),class:"max-w-52 w-full"},null,8,["modelValue","disabled"])]),_:1}),n(D,{label:"Verset de fin (optionnel)"},{default:i(()=>[n(Y,{modelValue:e(N),"onUpdate:modelValue":o[4]||(o[4]=r=>B(N)?N.value=r:null),modelModifiers:{number:!0},type:"number",min:e(w)||1,placeholder:"Même verset",disabled:!e(k)||!e(x),class:"max-w-52 w-full"},null,8,["modelValue","min","disabled"])]),_:1})]),n(D,{label:"Versions à comparer",required:"",description:`${e(u).length} version(s) sélectionnée(s) (minimum 2, maximum 6)`},{default:i(()=>[a("div",bs,[(d(!0),g(H,null,J(e(b),r=>(d(),g("div",{key:r.id,class:G(["p-3 rounded-lg border transition-colors cursor-pointer",e(u).includes(r.id)?"bg-primary-50 dark:bg-primary-950 border-primary-200 dark:border-primary-800":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800"]),onClick:ke=>I(r.id,!e(u).includes(r.id))},[a("div",ys,[n(ge,{"model-value":e(u).includes(r.id),disabled:e(u).length>=6&&!e(u).includes(r.id)},null,8,["model-value","disabled"]),a("div",null,[a("div",_s,v(r.name),1),a("div",hs,v(r.code)+" • "+v(r.language),1)])])],10,fs))),128))])]),_:1},8,["description"]),a("div",ks,[n(h,{type:"submit",loading:e(V),disabled:!e(U),color:"primary"},{default:i(()=>[...o[12]||(o[12]=[Q(" Démarrer la comparaison ",-1)])]),_:1},8,["loading","disabled"])])],32)]),_:1}))]),_:1})]),_:1}),e(s)&&e(X)?(d(),K(he,{key:0,open:e(F),"onUpdate:open":o[5]||(o[5]=r=>B(F)?F.value=r:null),verse:e(X),book:e(s).book,onClose:o[6]||(o[6]=r=>F.value=!1),onRefreshNote:o[7]||(o[7]=()=>{F.value=!1,me()})},null,8,["open","verse","book"])):M("",!0)])}}});export{Ls as default};
