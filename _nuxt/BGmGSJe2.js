const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./KbLDbrC0.js","./DirYneB6.js","./entry.Cvx0kPHj.css"])))=>i.map(i=>d[i]);
import{z as O,r as k,D as F,G as L,o as N,a4 as A,I as D,w as n,a5 as I,g as o,h as t,d as f,f as V,C as a,a7 as W,O as H,P as G,M as S,t as v,F as E,K as U,$ as K,S as Y,b as J,e as c}from"#entry";import{_ as Q}from"./Be_NR6f5.js";import{_ as X,a as Z,b as ee,c as te}from"./DrJ0uO0s.js";import{_ as se}from"./CvsAtPMi.js";import{_ as oe}from"./C_fCq-or.js";import"./mbsasbvT.js";import"./CxfdSycM.js";const ae={class:"space-y-6 py-6"},le={class:"flex items-center justify-between"},ne={key:0,class:"flex justify-center py-12"},ie={key:1,class:"space-y-6"},re={class:"flex items-center justify-end gap-2"},de={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},ue={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ce={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},me={class:"grid grid-cols-1 gap-4"},pe={class:"flex justify-between items-center"},_e={class:"font-medium"},fe={class:"flex justify-between items-center"},ge={class:"font-medium"},ve={key:0,class:"space-y-3"},ye={class:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center"},xe={class:"text-xs font-medium text-blue-600 dark:text-blue-400"},he={class:"flex-1 min-w-0"},be={class:"text-sm font-medium truncate"},ke={class:"text-xs text-gray-500"},Se={key:1,class:"text-sm text-gray-500"},Ce={class:"flex items-center justify-between"},$e={class:"flex gap-2"},we={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Te={class:"flex items-center justify-between mb-2"},Pe={class:"font-medium text-sm"},je={class:"text-xs text-gray-500"},Re={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-2"},De={key:0,class:"mt-2 flex items-center gap-1 text-green-600 dark:text-green-400"},Ve={key:1,class:"text-sm text-gray-500"},Le=O({__name:"stats",setup(Ee){const w=k(!0),C=k(""),s=k(null),x=k("30days"),g=k("all"),q=[{label:"7 derniers jours",value:"7days"},{label:"30 derniers jours",value:"30days"},{label:"90 derniers jours",value:"90days"},{label:"Cette année",value:"365days"}],j=F(()=>s.value?g.value==="all"?s.value.bookProgress:s.value.bookProgress.filter(m=>m.book.testament===g.value):[]),T=async()=>{try{w.value=!0,C.value="",s.value=await $fetch("/api/reading/stats",{query:{period:x.value}})}catch(m){C.value="Erreur lors du chargement des statistiques",console.error(m),s.value=null}finally{w.value=!1}};L(x,()=>{T()});const $=m=>{const e=Math.max(0,Math.floor(m||0)),l=Math.floor(e/3600),p=Math.floor(e%3600/60),r=e%60;return l>0?`${l}h${p>0?` ${p}m`:""}`:p>0?`${p}m${r>0?` ${r}s`:""}`:`${r}s`};N(()=>{T()});function z(){if(!s.value)return;const m=[];m.push("Date,Temps total (s),Chapitres lus,Versets lus,Sessions");for(const u of s.value.dailyStats){const _=new Date(u.date).toISOString().slice(0,10);m.push(`${_},${u.totalReadingTime},${u.chaptersRead},${u.versesRead??0},${u.sessionsCount}`)}const e=m.join(`
`),l=new Blob([e],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(l),r=document.createElement("a");r.href=p,r.download="reading_stats.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(p)}async function M(){if(!s.value)return;const{default:m}=await J(async()=>{const{default:i}=await import("./KbLDbrC0.js").then(y=>y.j);return{default:i}},__vite__mapDeps([0,1,2]),import.meta.url),e=new m;let l=10;e.setFontSize(14),e.text("Statistiques de lecture",10,l),l+=8,e.setFontSize(10),e.text(`Période: ${x.value}`,10,l),l+=6,e.text(`Temps total: ${$(s.value.summary.totalReadingTime)}`,10,l),l+=6,e.text(`Sessions: ${s.value.summary.totalSessions}`,10,l),l+=6,e.text(`Chapitres lus: ${s.value.summary.totalChaptersRead}`,10,l),l+=10;const p=["Date","Temps (s)","Chapitres","Versets","Sessions"],r=s.value.dailyStats.slice(-20).map(i=>[new Date(i.date).toISOString().slice(0,10),i.totalReadingTime.toString(),i.chaptersRead.toString(),(i.versesRead??0).toString(),i.sessionsCount.toString()]),u=[30,30,30,30,30];let _=l;p.forEach((i,y)=>{e.text(i,10+u.slice(0,y).reduce((h,b)=>h+b,0),_)}),_+=6,r.forEach(i=>{i.forEach((y,h)=>{e.text(y,10+u.slice(0,h).reduce((b,P)=>b+P,0),_)}),_+=6,_>280&&(e.addPage(),_=10)}),l=_+4,e.save("reading_stats.pdf")}return A({title:"Statistiques de lecture",meta:[{name:"description",content:"Suivez vos statistiques de lecture biblique, y compris le temps de lecture, les chapitres lus et plus encore."},{name:"keywords",content:"statistiques, lecture biblique, théologie, progression, temps de lecture"}]}),(m,e)=>{const l=Q,p=H,r=G,u=X,_=Z,i=se,y=ee,h=te,b=oe,P=Y,B=I;return c(),D(B,null,{default:n(()=>[o(P,null,{default:n(()=>[t("div",ae,[t("div",le,[e[4]||(e[4]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Statistiques de lecture "),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Suivez votre progression dans l'étude biblique ")],-1)),o(l,{modelValue:a(x),"onUpdate:modelValue":e[0]||(e[0]=d=>W(x)?x.value=d:null),items:q,"label-key":"label","value-key":"value",onChange:T},null,8,["modelValue"])]),a(w)?(c(),f("div",ne,[o(p,{name:"i-lucide-loader-2",class:"w-8 h-8 animate-spin"})])):a(s)?(c(),f("div",ie,[t("div",re,[o(r,{icon:"i-lucide-file-down",variant:"outline",size:"sm",onClick:z},{default:n(()=>[...e[5]||(e[5]=[S(" Export CSV ",-1)])]),_:1}),o(r,{icon:"i-lucide-file-text",variant:"outline",size:"sm",onClick:M},{default:n(()=>[...e[6]||(e[6]=[S(" Export PDF ",-1)])]),_:1})]),t("div",de,[o(u,{title:"Temps total",value:$(a(s).summary.totalReadingTime),icon:"i-lucide-clock",color:"blue"},null,8,["value"]),o(u,{title:"Sessions",value:a(s).summary.totalSessions.toString(),icon:"i-lucide-book-open",color:"green"},null,8,["value"]),o(u,{title:"Chapitres lus",value:a(s).summary.totalChaptersRead.toString(),icon:"i-lucide-scroll-text",color:"purple"},null,8,["value"]),o(u,{title:"Série actuelle",value:`${a(s).summary.currentStreak} jours`,icon:"i-lucide-flame",color:"orange"},null,8,["value"])]),t("div",ue,[o(i,null,{header:n(()=>[...e[7]||(e[7]=[t("h3",{class:"text-lg font-semibold"}," Temps de lecture quotidien ",-1)])]),default:n(()=>[o(_,{data:a(s).dailyStats},null,8,["data"])]),_:1}),o(i,null,{header:n(()=>[...e[8]||(e[8]=[t("h3",{class:"text-lg font-semibold"}," Progression des chapitres ",-1)])]),default:n(()=>[o(y,{data:a(s).dailyStats},null,8,["data"])]),_:1})]),t("div",ce,[o(i,null,{header:n(()=>[...e[9]||(e[9]=[t("h3",{class:"text-lg font-semibold"}," Heures préférées ",-1)])]),default:n(()=>[o(h,{data:a(s).timePreferences},null,8,["data"])]),_:1}),o(i,null,{header:n(()=>[...e[10]||(e[10]=[t("h3",{class:"text-lg font-semibold"}," Moyennes ",-1)])]),default:n(()=>[t("div",me,[t("div",pe,[e[11]||(e[11]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"}," Temps/jour (moyen) ",-1)),t("span",_e,v($(a(s).summary.averages.readingTimePerDay)),1)]),t("div",fe,[e[12]||(e[12]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"}," Chapitres/session (moyen) ",-1)),t("span",ge,v(Math.round(a(s).summary.averages.chaptersPerSession||0)),1)])])]),_:1}),o(i,null,{header:n(()=>[...e[13]||(e[13]=[t("h3",{class:"text-lg font-semibold"}," Top livres ",-1)])]),default:n(()=>[a(s).topBooks.length>0?(c(),f("div",ve,[(c(!0),f(E,null,U(a(s).topBooks.slice(0,5),(d,R)=>(c(),f("div",{key:d.name+"-"+R,class:"flex items-center gap-3"},[t("div",ye,[t("span",xe,v(R+1),1)]),t("div",he,[t("p",be,v(d.name),1),t("p",ke,v(d.sessions)+" sessions • "+v($(d.totalTime)),1)])]))),128))])):(c(),f("div",Se," Aucune donnée pour le moment. "))]),_:1})]),o(i,null,{header:n(()=>[t("div",Ce,[e[17]||(e[17]=t("h3",{class:"text-lg font-semibold"}," Progression par livre ",-1)),t("div",$e,[o(r,{variant:a(g)==="all"?"solid":"ghost",size:"xs",onClick:e[1]||(e[1]=d=>g.value="all")},{default:n(()=>[...e[14]||(e[14]=[S(" Tous ",-1)])]),_:1},8,["variant"]),o(r,{variant:a(g)==="OLD"?"solid":"ghost",size:"xs",onClick:e[2]||(e[2]=d=>g.value="OLD")},{default:n(()=>[...e[15]||(e[15]=[S(" AT ",-1)])]),_:1},8,["variant"]),o(r,{variant:a(g)==="NEW"?"solid":"ghost",size:"xs",onClick:e[3]||(e[3]=d=>g.value="NEW")},{default:n(()=>[...e[16]||(e[16]=[S(" NT ",-1)])]),_:1},8,["variant"])])])]),default:n(()=>[a(j).length>0?(c(),f("div",we,[(c(!0),f(E,null,U(a(j),d=>(c(),f("div",{key:d.book.code,class:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg"},[t("div",Te,[t("h4",Pe,v(d.book.name),1),t("span",je,v(d.completionPercentage)+"% ",1)]),t("div",Re,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:K({width:`${d.completionPercentage}%`})},null,4)]),d.isCompleted?(c(),f("div",De,[o(p,{name:"i-lucide-check-circle",class:"w-3 h-3"}),e[18]||(e[18]=t("span",{class:"text-xs"},"Terminé",-1))])):V("",!0)]))),128))])):(c(),f("div",Ve," Aucune progression disponible pour cette période. "))]),_:1})])):a(C)?(c(),D(b,{key:2,color:"error",variant:"soft",title:a(C)},null,8,["title"])):V("",!0)])]),_:1})]),_:1})}}});export{Le as default};
