import{z as V,a0 as $,r as v,Z as S,G as y,I as L,e as a,w as x,h as n,H as P,d as o,f,g as C,O as E,t as h,F as g,K as N,bk as U}from"#entry";import{v as F}from"./ChZFRpQR.js";const G=["id"],H={class:"w-72 max-w-xs p-2"},I={key:0,class:"flex items-center gap-2 text-gray-600"},M={key:1,class:"text-sm text-red-600"},O={key:2,class:"space-y-1"},R={class:"text-xs text-gray-500"},T={class:"italic text-gray-800 leading-relaxed"},j={class:"text-xs text-primary-600 dark:text-primary-400"},q=["innerHTML"],z={key:0},A={key:1},D=V({__name:"BiblicalReferencePopover",props:{verse:{}},setup(r){const{user:k}=$(),d=v(!1),m=v(!1),c=v(null),t=v(null),u=S("cache",()=>new Map);async function w(s){const e=F(s);e.version=e.version||k.value?.preferences.defaultVersion?.code||"LSG";const i=await $fetch(`/api/bible/verses/${e.book}/${e.chapter}/${e.verse}`,{method:"GET",query:{version:e.version}});if(!i.success)throw new Error("Erreur lors du chargement du verset.");return{reference:i.meta.summary,verses:i.data}}async function b(){if(c.value=null,u.value.has(r.verse)){t.value=u.value.get(r.verse);return}m.value=!0,t.value=null;try{const s=await w(r.verse);u.value.set(r.verse,s),t.value=s}catch{c.value="Impossible de charger le verset."}finally{m.value=!1}}const B=(s,e)=>e==null||s+1===e;return y(d,s=>{s&&b()}),y(()=>r.verse,()=>{t.value=u.value.get(r.verse)??null,c.value=null}),(s,e)=>{const i=E,p=U;return a(),L(p,{open:d.value,"onUpdate:open":e[0]||(e[0]=l=>d.value=l),mode:"hover"},{content:x(()=>[n("div",H,[m.value?(a(),o("div",I,[C(i,{name:"i-heroicons-arrow-path-20-solid",class:"animate-spin"}),e[1]||(e[1]=n("span",null,"Chargement du versetâ€¦",-1))])):c.value?(a(),o("div",M,h(c.value),1)):t.value?(a(),o("div",O,[n("div",R,h(t.value.reference),1),n("div",T,[(a(!0),o(g,null,N(t.value.verses,(l,_)=>(a(),o(g,{key:l.id},[n("sup",j,h(l.verse),1),n("span",{innerHTML:l.text},null,8,q),_<t.value.verses.length-1?(a(),o("span",z)):f("",!0),B(l.verse,t.value.verses[_+1]?.verse)?f("",!0):(a(),o("span",A," [...] "))],64))),128))])])):f("",!0)])]),default:x(()=>[n("a",{id:r.verse,class:"hover:underline"},[P(s.$slots,"default")],8,G)]),_:3},8,["open"])}}}),J=Object.assign(D,{__name:"BiblicalReferencePopover"});export{J as default};
