import{z as H,ba as ne,bb as de,ar as qe,r as V,a1 as me,I as C,ab as Te,C as t,w as n,g as l,P as Z,N as K,au as ge,a8 as ze,h,$ as ve,O as G,e as i,Q as fe,as as Oe,y as pe,b1 as Ve,b2 as be,an as he,bc as Ue,ax as Ne,D as N,b9 as Pe,d as P,H as j,f as _,n as z,ay as Ae,U as D,b6 as Q,t as A,F,K as J,bd as _e,be as R,aQ as Ee,av as X,aw as ye,a2 as Ke,bf as Re,bg as je,aU as re,aW as le,ao as Me,R as ue,bh as De,bi as Fe,v as ke,a0 as xe,bj as Ge,a7 as Y,G as ie,ac as Je,a3 as Qe,E as oe,a as He,J as We,o as Ye,bk as Ze,a6 as Xe,aB as et,Y as tt}from"#entry";import{_ as at}from"./B1bJNvZX.js";import{_ as ot,a as st}from"./ChfH4k70.js";import{_ as Se}from"./B5BmDUTd.js";import{_ as ce}from"./CvsAtPMi.js";import{_ as nt}from"./XQVZmSxM.js";import{_ as rt}from"./9VLIreS9.js";import{_ as lt}from"./Cscn447a.js";import{_ as it}from"./BUW2VJzu.js";import{u as se}from"./BeoGUvjE.js";import{d as ct}from"./D8rO69WY.js";import"./Dpy1dZNI.js";import"./BGeCMNnO.js";import"./C8liMDU-.js";import"./CiYoogra.js";import"./Cvaf6Jed.js";const ut={class:"flex items-center gap-2"},dt={class:"mt-2 flex items-center gap-1"},mt=H({__name:"BookmarkFormPopover",props:ne({verseId:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:ne(["closeForm","created"],["update:modelValue"]),setup(e,{emit:d}){const o=e,m=d,v=de(e,"modelValue"),x=qe({title:"",color:"blue"}),w=[{label:"Rouge",value:"red"},{label:"Rose",value:"pink"},{label:"Fuchsia",value:"fuchsia"},{label:"Violet",value:"purple"},{label:"Violet clair",value:"violet"},{label:"Indigo",value:"indigo"},{label:"Bleu",value:"blue"},{label:"Ciel",value:"sky"},{label:"Cyan",value:"cyan"},{label:"Teal",value:"teal"},{label:"Émeraude",value:"emerald"},{label:"Vert",value:"green"},{label:"Lime",value:"lime"},{label:"Jaune",value:"yellow"},{label:"Ambre",value:"amber"},{label:"Orange",value:"orange"},{label:"Brun",value:"brown"},{label:"Gris",value:"gray"},{label:"Gris neutre",value:"neutral"},{label:"Ardoise",value:"slate"},{label:"Pierre",value:"stone"},{label:"Zinc",value:"zinc"},{label:"Noir",value:"black"}],y=V(!1),p=V(""),I=me();function g(){v.value=!1,m("closeForm")}async function S(){p.value="",y.value=!0;try{const B=await $fetch("/api/bible/bookmarks",{method:"POST",body:{verseId:o.verseId,title:x.title,color:x.color}});B.success?(I.add({title:"Favori ajouté",description:B.message,color:"primary"}),m("created",B.data),g()):p.value=B.message||"Erreur inconnue"}catch(B){p.value=B?.statusMessage||"Erreur lors de l’ajout du favori"}finally{y.value=!1}}return(B,c)=>{const f=G,u=ze,s=ge,b=Se,a=Z,L=ce,$=nt;return i(),C($,{state:t(x),onSubmit:Te(S,["prevent"])},{default:n(()=>[l(L,{ui:{header:"p-2 sm:px-4",footer:"p-2 sm:px-4"}},{header:n(()=>[h("div",ut,[l(f,{name:"i-lucide-bookmark",class:"text-primary-600"}),c[2]||(c[2]=h("span",{class:"font-semibold text-sm"},"Ajouter aux signets",-1))])]),default:n(()=>[l(s,{label:"Titre (optionnel)",name:"title",class:"mb-4"},{default:n(()=>[l(u,{modelValue:t(x).title,"onUpdate:modelValue":c[0]||(c[0]=k=>t(x).title=k),placeholder:"Titre personnalisé...",class:"w-full"},null,8,["modelValue"])]),_:1}),l(s,{label:"Couleur du favori",name:"color"},{default:n(()=>[l(b,{modelValue:t(x).color,"onUpdate:modelValue":c[1]||(c[1]=k=>t(x).color=k),items:w,"label-key":"label","value-key":"value",class:"flex gap-2 w-full"},null,8,["modelValue"]),h("div",dt,[c[3]||(c[3]=K(" Aperçu : ",-1)),h("span",{style:ve([`background-color: var(--color-${t(x).color}-400)`,`border: solid 1px var(--color-${t(x).color}-700)`]),class:"inline-block size-4 rounded-full border"},null,4)])]),_:1})]),footer:n(()=>[l(a,{type:"submit",color:"primary",loading:t(y),class:"w-full flex justify-center"},{default:n(()=>[...c[4]||(c[4]=[K(" Ajouter ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["state"])}}}),gt=Object.assign(mt,{__name:"BookmarkFormPopover"}),we={__name:"UContextMenuContent",props:{items:{type:null,required:!1},portal:{type:[Boolean,String],required:!1,skipCheck:!0},sub:{type:Boolean,required:!1},labelKey:{type:null,required:!0},checkedIcon:{type:[String,Object],required:!1},loadingIcon:{type:[String,Object],required:!1},externalIcon:{type:[Boolean,String,Object],required:!1},class:{type:null,required:!1},ui:{type:null,required:!0},uiOverride:{type:null,required:!1},loop:{type:Boolean,required:!1},sideFlip:{type:Boolean,required:!1},alignOffset:{type:Number,required:!1},alignFlip:{type:Boolean,required:!1},avoidCollisions:{type:Boolean,required:!1},collisionBoundary:{type:null,required:!1},collisionPadding:{type:[Number,Object],required:!1},sticky:{type:String,required:!1},hideWhenDetached:{type:Boolean,required:!1},positionStrategy:{type:String,required:!1},disableUpdateOnLayoutShift:{type:Boolean,required:!1},prioritizePosition:{type:Boolean,required:!1},reference:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","closeAutoFocus"],setup(e,{emit:d}){const o=e,m=d,v=fe(),{dir:x}=Oe(),w=pe(),y=Ve(be(()=>o.portal)),p=he(Ue(o,"sub","items","portal","labelKey","checkedIcon","loadingIcon","externalIcon","class","ui","uiOverride"),m),I=()=>ye(v,["default"]),[g,S]=Ne(),B=N(()=>x.value==="rtl"?w.ui.icons.chevronLeft:w.ui.icons.chevronRight),c=N(()=>o.items?.length?Pe(o.items)?o.items:[o.items]:[]);return(f,u)=>(i(),P(F,null,[l(t(g),null,{default:n(({item:s,active:b,index:a})=>[j(f.$slots,s.slot||"item",{item:s,index:a},()=>[j(f.$slots,s.slot?`${s.slot}-leading`:"item-leading",{item:s,active:b,index:a},()=>[s.loading?(i(),C(G,{key:0,name:e.loadingIcon||t(w).ui.icons.loading,class:z(e.ui.itemLeadingIcon({class:[e.uiOverride?.itemLeadingIcon,s.ui?.itemLeadingIcon],color:s?.color,loading:!0}))},null,8,["name","class"])):s.icon?(i(),C(G,{key:1,name:s.icon,class:z(e.ui.itemLeadingIcon({class:[e.uiOverride?.itemLeadingIcon,s.ui?.itemLeadingIcon],color:s?.color,active:b}))},null,8,["name","class"])):s.avatar?(i(),C(Ae,D({key:2,size:s.ui?.itemLeadingAvatarSize||e.uiOverride?.itemLeadingAvatarSize||e.ui.itemLeadingAvatarSize()},s.avatar,{class:e.ui.itemLeadingAvatar({class:[e.uiOverride?.itemLeadingAvatar,s.ui?.itemLeadingAvatar],active:b})}),null,16,["size","class"])):_("",!0)]),t(Q)(s,o.labelKey)||v[s.slot?`${s.slot}-label`:"item-label"]?(i(),P("span",{key:0,class:z(e.ui.itemLabel({class:[e.uiOverride?.itemLabel,s.ui?.itemLabel],active:b}))},[j(f.$slots,s.slot?`${s.slot}-label`:"item-label",{item:s,active:b,index:a},()=>[K(A(t(Q)(s,o.labelKey)),1)]),s.target==="_blank"&&e.externalIcon!==!1?(i(),C(G,{key:0,name:typeof e.externalIcon=="string"?e.externalIcon:t(w).ui.icons.external,class:z(e.ui.itemLabelExternalIcon({class:[e.uiOverride?.itemLabelExternalIcon,s.ui?.itemLabelExternalIcon],color:s?.color,active:b}))},null,8,["name","class"])):_("",!0)],2)):_("",!0),h("span",{class:z(e.ui.itemTrailing({class:[e.uiOverride?.itemTrailing,s.ui?.itemTrailing]}))},[j(f.$slots,s.slot?`${s.slot}-trailing`:"item-trailing",{item:s,active:b,index:a},()=>[s.children?.length?(i(),C(G,{key:0,name:B.value,class:z(e.ui.itemTrailingIcon({class:[e.uiOverride?.itemTrailingIcon,s.ui?.itemTrailingIcon],color:s?.color,active:b}))},null,8,["name","class"])):s.kbds?.length?(i(),P("span",{key:1,class:z(e.ui.itemTrailingKbds({class:[e.uiOverride?.itemTrailingKbds,s.ui?.itemTrailingKbds]}))},[(i(!0),P(F,null,J(s.kbds,(L,$)=>(i(),C(_e,D({key:$,size:s.ui?.itemTrailingKbdsSize||e.uiOverride?.itemTrailingKbdsSize||e.ui.itemTrailingKbdsSize()},{ref_for:!0},typeof L=="string"?{value:L}:L),null,16,["size"]))),128))],2)):_("",!0)]),l(t(R).ItemIndicator,{"as-child":""},{default:n(()=>[l(G,{name:e.checkedIcon||t(w).ui.icons.check,class:z(e.ui.itemTrailingIcon({class:[e.uiOverride?.itemTrailingIcon,s.ui?.itemTrailingIcon],color:s?.color}))},null,8,["name","class"])]),_:2},1024)],2)])]),_:3}),l(t(R).Portal,re(le(t(y))),{default:n(()=>[(i(),C(Ee(e.sub?t(R).SubContent:t(R).Content),D({class:o.class},t(p)),{default:n(()=>[j(f.$slots,"content-top"),h("div",{role:"presentation",class:z(e.ui.viewport({class:e.uiOverride?.viewport}))},[(i(!0),P(F,null,J(c.value,(s,b)=>(i(),C(t(R).Group,{key:`group-${b}`,class:z(e.ui.group({class:e.uiOverride?.group}))},{default:n(()=>[(i(!0),P(F,null,J(s,(a,L)=>(i(),P(F,{key:`group-${b}-${L}`},[a.type==="label"?(i(),C(t(R).Label,{key:0,class:z(e.ui.label({class:[e.uiOverride?.label,a.ui?.label,a.class]}))},{default:n(()=>[l(t(S),{item:a,index:L},null,8,["item","index"])]),_:2},1032,["class"])):a.type==="separator"?(i(),C(t(R).Separator,{key:1,class:z(e.ui.separator({class:[e.uiOverride?.separator,a.ui?.separator,a.class]}))},null,8,["class"])):a?.children?.length?(i(),C(t(R).Sub,{key:2,open:a.open,"default-open":a.defaultOpen},{default:n(()=>[l(t(R).SubTrigger,{as:"button",type:"button",disabled:a.disabled,"text-value":t(Q)(a,o.labelKey),class:z(e.ui.item({class:[e.uiOverride?.item,a.ui?.item,a.class],color:a?.color}))},{default:n(()=>[l(t(S),{item:a,index:L},null,8,["item","index"])]),_:2},1032,["disabled","text-value","class"]),l(we,D({sub:"",class:o.class,ui:e.ui,"ui-override":e.uiOverride,portal:e.portal,items:a.children,"align-offset":-4,"label-key":e.labelKey,"checked-icon":e.checkedIcon,"loading-icon":e.loadingIcon,"external-icon":e.externalIcon},{ref_for:!0},a.content),X({_:2},[J(I(),($,k)=>({name:k,fn:n(E=>[j(f.$slots,k,D({ref_for:!0},E))])}))]),1040,["class","ui","ui-override","portal","items","label-key","checked-icon","loading-icon","external-icon"])]),_:2},1032,["open","default-open"])):a.type==="checkbox"?(i(),C(t(R).CheckboxItem,{key:3,"model-value":a.checked,disabled:a.disabled,"text-value":t(Q)(a,o.labelKey),class:z(e.ui.item({class:[e.uiOverride?.item,a.ui?.item,a.class],color:a?.color})),"onUpdate:modelValue":a.onUpdateChecked,onSelect:a.onSelect},{default:n(()=>[l(t(S),{item:a,index:L},null,8,["item","index"])]),_:2},1032,["model-value","disabled","text-value","class","onUpdate:modelValue","onSelect"])):(i(),C(t(R).Item,{key:4,"as-child":"",disabled:a.disabled,"text-value":t(Q)(a,o.labelKey),onSelect:a.onSelect},{default:n(()=>[l(Ke,D({ref_for:!0},t(Re)(a),{custom:""}),{default:n(({active:$,...k})=>[l(je,D({ref_for:!0},k,{class:e.ui.item({class:[e.uiOverride?.item,a.ui?.item,a.class],active:$,color:a?.color})}),{default:n(()=>[l(t(S),{item:a,active:$,index:L},null,8,["item","active","index"])]),_:2},1040,["class"])]),_:2},1040)]),_:2},1032,["disabled","text-value","onSelect"]))],64))),128))]),_:2},1032,["class"]))),128))],2),j(f.$slots,"default"),j(f.$slots,"content-bottom")]),_:3},16,["class"]))]),_:3},16)],64))}},vt={slots:{content:"min-w-32 bg-default shadow-lg rounded-md ring ring-default overflow-hidden data-[state=open]:animate-[scale-in_100ms_ease-out] data-[state=closed]:animate-[scale-out_100ms_ease-in] origin-(--reka-context-menu-content-transform-origin) flex flex-col",viewport:"relative divide-y divide-default scroll-py-1 overflow-y-auto flex-1",group:"p-1 isolate",label:"w-full flex items-center font-semibold text-highlighted",separator:"-mx-1 my-1 h-px bg-border",item:"group relative w-full flex items-center select-none outline-none before:absolute before:z-[-1] before:inset-px before:rounded-md data-disabled:cursor-not-allowed data-disabled:opacity-75",itemLeadingIcon:"shrink-0",itemLeadingAvatar:"shrink-0",itemLeadingAvatarSize:"",itemTrailing:"ms-auto inline-flex gap-1.5 items-center",itemTrailingIcon:"shrink-0",itemTrailingKbds:"hidden lg:inline-flex items-center shrink-0",itemTrailingKbdsSize:"",itemLabel:"truncate",itemLabelExternalIcon:"inline-block size-3 align-top text-dimmed"},variants:{color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},active:{true:{item:"text-highlighted before:bg-elevated",itemLeadingIcon:"text-default"},false:{item:["text-default data-highlighted:text-highlighted data-[state=open]:text-highlighted data-highlighted:before:bg-elevated/50 data-[state=open]:before:bg-elevated/50","transition-colors before:transition-colors"],itemLeadingIcon:["text-dimmed group-data-highlighted:text-default group-data-[state=open]:text-default","transition-colors"]}},loading:{true:{itemLeadingIcon:"animate-spin"}},size:{xs:{label:"p-1 text-xs gap-1",item:"p-1 text-xs gap-1",itemLeadingIcon:"size-4",itemLeadingAvatarSize:"3xs",itemTrailingIcon:"size-4",itemTrailingKbds:"gap-0.5",itemTrailingKbdsSize:"sm"},sm:{label:"p-1.5 text-xs gap-1.5",item:"p-1.5 text-xs gap-1.5",itemLeadingIcon:"size-4",itemLeadingAvatarSize:"3xs",itemTrailingIcon:"size-4",itemTrailingKbds:"gap-0.5",itemTrailingKbdsSize:"sm"},md:{label:"p-1.5 text-sm gap-1.5",item:"p-1.5 text-sm gap-1.5",itemLeadingIcon:"size-5",itemLeadingAvatarSize:"2xs",itemTrailingIcon:"size-5",itemTrailingKbds:"gap-0.5",itemTrailingKbdsSize:"md"},lg:{label:"p-2 text-sm gap-2",item:"p-2 text-sm gap-2",itemLeadingIcon:"size-5",itemLeadingAvatarSize:"2xs",itemTrailingIcon:"size-5",itemTrailingKbds:"gap-1",itemTrailingKbdsSize:"md"},xl:{label:"p-2 text-base gap-2",item:"p-2 text-base gap-2",itemLeadingIcon:"size-6",itemLeadingAvatarSize:"xs",itemTrailingIcon:"size-6",itemTrailingKbds:"gap-1",itemTrailingKbdsSize:"lg"}}},compoundVariants:[{color:"primary",active:!1,class:{item:"text-primary data-highlighted:text-primary data-highlighted:before:bg-primary/10 data-[state=open]:before:bg-primary/10",itemLeadingIcon:"text-primary/75 group-data-highlighted:text-primary group-data-[state=open]:text-primary"}},{color:"secondary",active:!1,class:{item:"text-secondary data-highlighted:text-secondary data-highlighted:before:bg-secondary/10 data-[state=open]:before:bg-secondary/10",itemLeadingIcon:"text-secondary/75 group-data-highlighted:text-secondary group-data-[state=open]:text-secondary"}},{color:"success",active:!1,class:{item:"text-success data-highlighted:text-success data-highlighted:before:bg-success/10 data-[state=open]:before:bg-success/10",itemLeadingIcon:"text-success/75 group-data-highlighted:text-success group-data-[state=open]:text-success"}},{color:"info",active:!1,class:{item:"text-info data-highlighted:text-info data-highlighted:before:bg-info/10 data-[state=open]:before:bg-info/10",itemLeadingIcon:"text-info/75 group-data-highlighted:text-info group-data-[state=open]:text-info"}},{color:"warning",active:!1,class:{item:"text-warning data-highlighted:text-warning data-highlighted:before:bg-warning/10 data-[state=open]:before:bg-warning/10",itemLeadingIcon:"text-warning/75 group-data-highlighted:text-warning group-data-[state=open]:text-warning"}},{color:"error",active:!1,class:{item:"text-error data-highlighted:text-error data-highlighted:before:bg-error/10 data-[state=open]:before:bg-error/10",itemLeadingIcon:"text-error/75 group-data-highlighted:text-error group-data-[state=open]:text-error"}},{color:"primary",active:!0,class:{item:"text-primary before:bg-primary/10",itemLeadingIcon:"text-primary"}},{color:"secondary",active:!0,class:{item:"text-secondary before:bg-secondary/10",itemLeadingIcon:"text-secondary"}},{color:"success",active:!0,class:{item:"text-success before:bg-success/10",itemLeadingIcon:"text-success"}},{color:"info",active:!0,class:{item:"text-info before:bg-info/10",itemLeadingIcon:"text-info"}},{color:"warning",active:!0,class:{item:"text-warning before:bg-warning/10",itemLeadingIcon:"text-warning"}},{color:"error",active:!0,class:{item:"text-error before:bg-error/10",itemLeadingIcon:"text-error"}}],defaultVariants:{size:"md"}},ft={__name:"UContextMenu",props:{size:{type:null,required:!1},items:{type:null,required:!1},checkedIcon:{type:[String,Object],required:!1},loadingIcon:{type:[String,Object],required:!1},externalIcon:{type:[Boolean,String,Object],required:!1,default:!0},content:{type:Object,required:!1},portal:{type:[Boolean,String],required:!1,skipCheck:!0,default:!0},labelKey:{type:null,required:!1,default:"label"},disabled:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},pressOpenDelay:{type:Number,required:!1},modal:{type:Boolean,required:!1,default:!0}},emits:["update:open"],setup(e,{emit:d}){const o=e,m=d,v=fe(),x=pe(),w=he(Me(o,"modal"),m),y=be(()=>o.content),p=()=>ye(v,["default"]),I=N(()=>ue({extend:ue(vt),...x.ui?.contextMenu||{}})({size:o.size}));return(g,S)=>(i(),C(t(Fe),re(le(t(w))),{default:n(()=>[v.default?(i(),C(t(De),{key:0,"as-child":"",disabled:e.disabled,class:z(o.class)},{default:n(()=>[j(g.$slots,"default")]),_:3},8,["disabled","class"])):_("",!0),l(we,D({class:I.value.content({class:[!v.default&&o.class,o.ui?.content]}),ui:I.value,"ui-override":o.ui},y.value,{items:e.items,portal:e.portal,"label-key":e.labelKey,"checked-icon":e.checkedIcon,"loading-icon":e.loadingIcon,"external-icon":e.externalIcon}),X({_:2},[J(p(),(B,c)=>({name:c,fn:n(f=>[j(g.$slots,c,re(le(f)))])}))]),1040,["class","ui","ui-override","items","portal","label-key","checked-icon","loading-icon","external-icon"])]),_:3},16))}},pt={class:"inline-block align-top text-xs text-primary-600 dark:text-primary-400"},bt={class:"flex items-center justify-between gap-2"},ht=H({__name:"BibleVerse",props:{book:{},verse:{},notes:{},bookmark:{}},emits:["showCompare","addNote","refreshBookmark","refreshNote"],setup(e,{emit:d}){const o=e,m=d,v=ke(),x=V(!1),w=V(!1),y=me(),p=V(!1),I=V(!1),g=v.query.verse,{loggedIn:S}=xe(),B=N(()=>{const b=[{label:"Comparer",icon:"i-lucide-eye",onSelect:()=>m("showCompare",o.verse.verse),ui:{item:"cursor-pointer"}}];return S.value&&(b.push({label:"Marquer",icon:"i-lucide-bookmark",onSelect:()=>w.value=!0,ui:{item:"cursor-pointer"}}),b.push({label:"Ajouter Note",icon:"i-lucide-notebook-pen",onSelect:()=>I.value=!0,ui:{item:"cursor-pointer"}})),b}),c=async()=>{if(o.bookmark)try{await $fetch(`/api/bible/bookmarks/${o.bookmark.id}`,{method:"DELETE"}),y.add({title:"Signet supprimé",description:"Le signet a été supprimer avec succès"}),m("refreshBookmark")}catch(b){console.log(b)}},f=V(null),u=b=>{f.value=b,I.value=!0},s=N(()=>{if(!g)return!1;if(g===o.verse.verse.toString())return!0;if(!g.includes("-")&&!g.includes(";"))return!1;const b=g.split(";").map($=>$.trim());if(b.length>1)return b.some($=>{const k=$.split("-").map(M=>M.trim()),E=[];for(let M=Number(k[0]);M<=Number(k[k.length-1]);M++)E.push(M.toString());return E.includes(o.verse.verse.toString())});const a=g.split("-").map($=>$.trim()),L=[];for(let $=Number(a[0]);$<=Number(a[a.length-1]);$++)L.push($.toString());return L.includes(o.verse.verse.toString())});return(b,a)=>{const L=G,$=Z,k=ce,E=Ge,M=gt,ee=ft,te=rt,ae=lt;return i(),P(F,null,[l(ee,{items:t(B)},{default:n(()=>[h("span",null,[t(S)&&e.notes.length?(i(),P("button",{key:0,class:"cursor-pointer mr-0.5",onClick:a[0]||(a[0]=T=>p.value=!0)},[l(L,{name:"i-lucide-notebook-pen",class:"size-3 text-warning-500 dark:text-warning-400"})])):_("",!0),h("span",pt,A(e.verse.verse),1),l(E,{open:t(w),"onUpdate:open":a[5]||(a[5]=T=>Y(w)?w.value=T:null),content:{sideOffset:0},arrow:""},{anchor:n(()=>[h("span",{class:z({underline:t(w)||e.bookmark,"bg-yellow-500/20":t(s)})},[e.bookmark?(i(),C(E,{key:1,mode:"hover",arrow:"","onUpdate:open":a[2]||(a[2]=T=>!T&&(x.value=!1))},{content:n(()=>[l(k,{ui:{header:"p-2 sm:px-4",footer:"p-2 sm:px-4 flex items-center space-x-4"}},X({header:n(()=>[h("div",bt,[h("p",null,A(e.bookmark.title||"Signet"),1),h("span",{class:"cursor-pointer rounded-sm bg-gray-50 hover:bg-red-50 flex items-center justify-center p-1 text-red-500 hover:text-red-700",onClick:a[1]||(a[1]=T=>x.value=!0)},[l(L,{name:"i-lucide-trash-2"})])])]),_:2},[t(x)?{name:"footer",fn:n(()=>[l($,{size:"sm",color:"error",onClick:c},{default:n(()=>[...a[10]||(a[10]=[K(" Supprimer ",-1)])]),_:1}),l($,{size:"sm",variant:"outline",color:"neutral"},{default:n(()=>[...a[11]||(a[11]=[K(" Annuler ",-1)])]),_:1})]),key:"0"}:void 0]),1024)]),default:n(()=>[h("span",{class:z(["decoration-2",{underline:t(w)||e.bookmark}]),style:ve(`text-decoration-color: var(--color-${e.bookmark?.color}-500)`)},A(e.verse.text),7)]),_:1})):(i(),P(F,{key:0},[K(A(e.verse.text),1)],64))],2)]),content:n(()=>[l(M,{"verse-id":e.verse.id,onCloseForm:a[3]||(a[3]=T=>w.value=!1),onCreated:a[4]||(a[4]=T=>m("refreshBookmark"))},null,8,["verse-id"])]),_:1},8,["open"])])]),_:1},8,["items"]),l(te,{open:t(p),"onUpdate:open":a[6]||(a[6]=T=>Y(p)?p.value=T:null),notes:e.notes,verse:e.verse,book:e.book,"onEdit:note":u,onRefreshNote:a[7]||(a[7]=T=>m("refreshNote"))},null,8,["open","notes","verse","book"]),l(ae,{open:t(I),"onUpdate:open":a[8]||(a[8]=T=>Y(I)?I.value=T:null),verse:e.verse,book:e.book,note:t(f),onRefreshNote:a[9]||(a[9]=T=>m("refreshNote"))},null,8,["open","verse","book","note"])],64)}}}),yt=Object.assign(ht,{__name:"BibleVerse"}),kt={class:"p-6"},xt={class:"space-y-4"},St={class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},wt={class:"font-medium"},It={key:0},$t={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-60 overflow-y-auto"},Ct=["onClick"],Bt={class:"text-sm font-medium text-gray-900 dark:text-white"},Lt={class:"text-xs text-gray-500 dark:text-gray-400"},qt={class:"mt-2 text-xs text-gray-500"},Tt={class:"flex justify-end gap-2 mt-6"},zt=H({__name:"BibleCompareModal",props:ne({availableVersions:{},book:{},chapter:{},version:{},verseStart:{},verseEnd:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const d=e,o=de(e,"modelValue"),m=V(!1),v=V([d.version]),x=y=>{const p=v.value.indexOf(y);p>-1?v.value.splice(p,1):v.value.length<6&&v.value.push(y)},w=async()=>{if(!(v.value.length<2))try{m.value=!0;const y=d.availableVersions.filter(I=>v.value.includes(I.id)).map(I=>I.code),p=new URLSearchParams({book:d.book.code,chapter:d.chapter.toString(),verses:d.verseStart.toString(),versions:y.join(",")});d.verseEnd&&d.verseEnd!==d.verseStart&&p.set("verses",d.verseStart.toString()+"-"+d.verseEnd.toString()),await Qe(`/bible/compare?${p.toString()}`)}catch(y){console.error("Erreur lors de la comparaison:",y)}finally{m.value=!1,o.value=!1}};return ie(()=>d.version,y=>{v.value=[y]}),(y,p)=>{const I=it,g=ge,S=Z,B=Je;return i(),C(B,{open:o.value,"onUpdate:open":p[1]||(p[1]=c=>o.value=c),title:"Comparer ce passage",description:"Terme théologique",ui:{description:"hidden",content:"max-w-2xl"}},{content:n(()=>[h("div",kt,[h("div",xt,[h("div",null,[p[2]||(p[2]=h("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-2"}," Passage sélectionné : ",-1)),h("div",St,[h("p",wt,[K(A(e.book.name)+" "+A(e.chapter)+":"+A(e.verseStart)+" ",1),e.verseEnd&&e.verseEnd!==e.verseStart?(i(),P("span",It," -"+A(e.verseEnd),1)):_("",!0)])])]),l(g,{label:"Versions à comparer (sélectionnez 2 à 6 versions)"},{default:n(()=>[h("div",$t,[(i(!0),P(F,null,J(e.availableVersions,c=>(i(),P("div",{key:c.id,class:"flex items-center space-x-2"},[l(I,{"model-value":t(v).includes(c.id),disabled:t(v).length>=6&&!t(v).includes(c.id),"onUpdate:modelValue":f=>x(c.id)},null,8,["model-value","disabled","onUpdate:modelValue"]),h("div",{class:"flex-1",onClick:f=>x(c.id)},[h("div",Bt,A(c.name),1),h("div",Lt,A(c.code)+" • "+A(c.language),1)],8,Ct)]))),128))]),h("div",qt,A(t(v).length)+" version(s) sélectionnée(s) (minimum 2, maximum 6) ",1)]),_:1})]),h("div",Tt,[l(S,{label:"Annuler",variant:"ghost",onClick:p[0]||(p[0]=c=>o.value=!1)}),l(S,{label:"Comparer",disabled:t(v).length<2,loading:t(m),onClick:w},null,8,["disabled","loading"])])])]),_:1},8,["open"])}}}),Ot=Object.assign(zt,{__name:"BibleCompareModal"}),Vt={class:"space-y-6"},Ut={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},Nt={class:"flex flex-1 items-center gap-2"},Pt={class:"space-x-1"},At={class:"flex justify-center gap-2"},_t=H({__name:"BibleReader",props:{book:{},chapter:{},versesData:{},notes:{},bookmarks:{},versions:{},selectedVersion:{}},emits:["update:chapter","refreshBookmark","refreshNotes"],setup(e,{emit:d}){const o=e,m=f=>{v.value={book:{code:o.book.code,name:o.book.name},verseStart:f,chapter:o.chapter,version:o.selectedVersion.id},w.value=!0},v=V(null),x=f=>{v.value={book:{code:o.book.code,name:o.book.name},verseStart:f,chapter:o.chapter,version:o.selectedVersion.id},y.value=!0},w=V(!1),y=V(!1),p=d,I=N(()=>Array.from({length:o.versesData?.navigation.totalChapters||0},(f,u)=>u+1)),g=f=>o.notes.filter(u=>u.verse.verse===f)||[],S=f=>o.bookmarks.find(u=>u.verse.verse===f)||null,B=N(()=>o.versesData?.verses||[]),c=f=>{p("update:chapter",f)};return(f,u)=>{const s=Se,b=Z,a=yt,L=ce,$=Ot;return i(),P("div",Vt,[l(L,{class:"mb-4"},{header:n(()=>[h("div",Ut,[h("div",Nt,[u[5]||(u[5]=h("p",null,"Chapitre",-1)),l(s,{items:I.value,"model-value":e.chapter,placeholder:"Chapitre",class:"w-32","onUpdate:modelValue":c},null,8,["items","model-value"])]),l(b,{color:"secondary",variant:"ghost",to:"/bible/compare","trailing-icon":"i-lucide-chevron-right"},{default:n(()=>[...u[6]||(u[6]=[K(" Comparer ",-1)])]),_:1})])]),footer:n(()=>[h("div",At,[e.versesData?.navigation.previousChapter?(i(),C(b,{key:0,icon:"i-lucide-arrow-left",color:"primary",variant:"soft",onClick:u[2]||(u[2]=k=>c(e.versesData.navigation.previousChapter))},{default:n(()=>[...u[7]||(u[7]=[K(" Précédent ",-1)])]),_:1})):_("",!0),e.versesData?.navigation.nextChapter?(i(),C(b,{key:1,"trailing-icon":"i-lucide-arrow-right",color:"primary",variant:"soft",onClick:u[3]||(u[3]=k=>c(e.versesData.navigation.nextChapter))},{default:n(()=>[...u[8]||(u[8]=[K(" Suivant ",-1)])]),_:1})):_("",!0)])]),default:n(()=>[h("div",Pt,[(i(!0),P(F,null,J(B.value,k=>(i(),C(a,{key:k.id,book:e.book,verse:k,notes:g(k.verse),bookmark:S(k.verse),onShowCompare:m,onAddNote:x,onRefreshBookmark:u[0]||(u[0]=E=>p("refreshBookmark")),onRefreshNote:u[1]||(u[1]=E=>p("refreshNotes"))},null,8,["book","verse","notes","bookmark"]))),128))])]),_:1}),t(v)?(i(),C($,D({key:0,modelValue:t(w),"onUpdate:modelValue":u[4]||(u[4]=k=>Y(w)?w.value=k:null)},t(v),{"available-versions":e.versions}),null,16,["modelValue","available-versions"])):_("",!0)])}}}),Et=Object.assign(_t,{__name:"BibleReader"}),aa=H({__name:"index",async setup(e){let d,o;const m=ke(),{user:v,loggedIn:x}=xe(),{data:w}=([d,o]=oe(()=>se("bible-books",()=>$fetch("/api/bible/books"),{transform:r=>r?.data||[]})),d=await d,o(),d),{data:y}=([d,o]=oe(()=>se("bible-versions",()=>$fetch("/api/bible/versions"),{transform:r=>r?.data||[]})),d=await d,o(),d),{data:p}=([d,o]=oe(()=>se("bible-verses",()=>$fetch(`/api/bible/verses/${m.query.book||"GEN"}/${m.query.chapter||"1"}`,{query:{version:m.query.version||v.value?.preferences?.defaultVersion?.code||"LSG"}}),{watch:[()=>m.query],transform:r=>r?.data||[]})),d=await d,o(),d),I=He(),g=N({get:()=>m.query.book||"GEN",set:r=>{I.push({query:{...m.query,book:r}})}}),S=N({get:()=>parseInt(m.query.chapter||"1"),set:r=>{I.push({query:{...m.query,chapter:r}})}}),B=N({get:()=>m.query.version||v.value?.preferences.defaultVersion?.code||"LSG",set:r=>{I.push({query:{...m.query,version:r}})}}),c=N(()=>w.value?.all||[]),f=V(null),u=V([]),s=V([]),b=V([]),a=N(()=>{const r=w.value?.grouped||{old:[],new:[]},O=r.old,U=r.new;return[{label:"Ancien Testament",open:O.some(q=>q.code===g.value),active:O.some(q=>q.code===g.value),ui:{link:"cursor-pointer"},children:O.map(q=>({label:q.name,onSelect:async()=>await E(q.code),active:g.value===q.code,ui:{link:"cursor-pointer"}}))},{label:"Nouveau Testament",open:U.some(q=>q.code===g.value),active:U.some(q=>q.code===g.value),ui:{link:"cursor-pointer"},children:U.map(q=>({label:q.name,onSelect:async()=>await E(q.code),active:g.value===q.code,ui:{link:"cursor-pointer"}}))}]}),L=N(()=>y.value?y.value.map(r=>({label:r.name,to:I.resolve({query:{...m.query,version:r.code}}).href,active:B.value===r.code})):[]),$=N(()=>!c.value||!g.value?null:c.value.find(r=>r.code==g.value)),k=N(()=>!y.value||!B.value?null:y.value.find(r=>r.code==B.value)),E=async r=>{await I.push({query:{...m.query,book:r,chapter:1}})},M=(r,O)=>{if(!u.value)return;const U=u.value.find(q=>q.bookCode===r);U?U.chaptersId.includes(O)||U.chaptersId.push(O):u.value.push({bookCode:r,chaptersId:[O]})},ee=async r=>{await I.push({query:{...m.query,chapter:r}}),x&&g.value&&M(g.value,r)};We({title:"Lire la Bible en ligne - Théologie Pour Tous",ogTitle:"Lire la Bible en ligne - Théologie Pour Tous",description:"Lisez la Bible en ligne avec différentes versions disponibles. Parcourez les livres et chapitres de la Bible facilement.",ogDescription:"Lisez la Bible en ligne avec différentes versions disponibles. Parcourez les livres et chapitres de la Bible facilement."});const te=async()=>{if(!(!x||!k.value||!y.value))try{const r=y.value.find(U=>U.code===B.value)?.id;if(!r)return;const O=await $fetch("/api/reading/sessions",{method:"POST",body:{action:"start",versionId:r,chaptersRead:JSON.stringify([{bookCode:g.value,chaptersId:S.value?[S.value]:[]}])}});if(O.success&&O.sessionId){const U=[{bookCode:g.value,chaptersId:S.value?[S.value]:[]}];f.value={id:O.sessionId,chaptersRead:U},u.value=U}}catch(r){console.error("Erreur lors du démarrage de la session:",r)}},ae=async()=>{if(!(!x||!f.value))try{await $fetch("/api/reading/sessions",{method:"POST",body:{action:"end",sessionId:f.value.id,chaptersRead:JSON.stringify(u.value)}})}catch(r){console.error("Erreur lors de la fermeture de la session:",r)}};Ye(async()=>{x&&(await te(),await T(),await W())}),Ze(async()=>{x&&await ae()});const T=async()=>{if(!(!B.value||!g.value||!S.value))try{const r=await $fetch("/api/bible/notes",{method:"GET",query:{book:g.value,chapter:S.value,version:B.value}});s.value=r?.data.notes||[]}catch(r){console.error("Erreur lors du chargement des notes:",r)}},W=async()=>{if(!(!k.value||!g.value||!S.value))try{const r=await $fetch("/api/bible/bookmarks",{method:"GET",query:{book:g.value,chapter:S.value,version:B.value}});b.value=r?.data.bookmarks||[]}catch(r){console.error("Erreur lors du chargement des signets:",r)}};return ie([()=>m.query.chapter,()=>m.query.book],async()=>{await T(),await W()}),ie(B,async()=>{v.value?.preferences?.notesPerVersion&&await T(),v.value?.preferences?.bookmarksPerVersion&&await W()}),ct(),(r,O)=>{const U=et,q=at,Ie=ot,$e=Et,Ce=tt,Be=st,Le=Xe;return i(),C(Le,null,X({left:n(()=>[l(q,null,{top:n(()=>[...O[0]||(O[0]=[K(" Les livres ",-1)])]),default:n(()=>[t(c)?.length?(i(),C(U,{key:0,items:t(a),highlight:"",orientation:"vertical"},null,8,["items"])):_("",!0)]),_:1})]),default:n(()=>[t($)&&t(S)?(i(),C(Ie,{key:0,title:`${t($).name} ${t(S)}`,description:t(k)?.name||"Aucune version sélectionnée"},null,8,["title","description"])):_("",!0),l(Be,null,{default:n(()=>[h("div",null,[t($)&&t(S)&&t(k)&&t(p)?(i(),C($e,{key:0,book:t($),chapter:t(S),"verses-data":t(p),versions:t(y)||[],"selected-version":t(k),notes:t(s),bookmarks:t(b),"onUpdate:chapter":ee,onRefreshBookmark:W,onRefreshNotes:T},null,8,["book","chapter","verses-data","versions","selected-version","notes","bookmarks"])):_("",!0)]),l(Ce)]),_:1})]),_:2},[t(y)?.length?{name:"right",fn:n(()=>[l(q,null,{top:n(()=>[...O[1]||(O[1]=[K(" Versions disponibles ",-1)])]),default:n(()=>[l(U,{items:t(L),variant:"link",orientation:"vertical"},null,8,["items"])]),_:1})]),key:"0"}:void 0]),1024)}}});export{aa as default};
