import{z as j,a0 as F,v as R,E as w,X as G,J as H,a4 as J,D as M,I as m,f as r,C as t,w as l,S as K,h as i,g as p,d as _,K as $,P as X,F as b,O as Y,t as C,N as Q,av as W,Y as Z,a6 as ee,e as s}from"#entry";import{_ as te,a as se}from"./ChfH4k70.js";import{_ as ae,a as oe,b as ne}from"./BojSHFMT.js";import{s as re,v as le}from"./ChZFRpQR.js";import{u as h}from"./BeoGUvjE.js";import{q as ie,b as ce}from"./DEMGGW71.js";import"./CAPy4cF5.js";import"./iik6CYzq.js";import"./DLVSv_Sa.js";const ue=["src"],de={class:"flex flex-col lg:flex-row items-start lg:items-center space-x-1"},me={class:"text-muted"},pe={key:0},_e={class:"flex flex-col md:flex-row md:items-center gap-2 mt-4"},fe={key:0,class:"text-sm font-medium text-muted"},ge={class:"flex flex-wrap items-center gap-2"},Te=j({__name:"[slug]",async setup(he){let o,f;const{loggedIn:y}=F(),c=R(),{data:e}=([o,f]=w(()=>h(c.path,()=>ie("lessons").path(c.path).first(),"$jlyxFBwIyO")),o=await o,f(),o);if(!e.value)throw G({statusCode:404,statusMessage:"Lesson not found",fatal:!0});const{data:v,refresh:S,status:k}=h(c.path+"-progress",()=>$fetch(`/api/teaching/progress/${e.value?.theme}`,{method:"GET"}),{immediate:y.value,server:!1}),{data:T}=([o,f]=w(()=>h("bible-books",()=>$fetch("/api/bible/books",{method:"GET"}))),o=await o,f(),o),{data:x}=h(`${c.path}-surround`,()=>ce("lessons",c.path,{fields:["description"]}).where("theme","=",c.params.theme)),U=u=>{if(!v.value?.data)return!1;const a=v.value?.data.lessons;if(!a)return!1;const d=JSON.parse(a);return d.length&&d.includes(u)},B=async u=>{try{await $fetch(`/api/teaching/progress/${e.value?.theme}`,{method:"POST",body:{lesson:u}}),await S()}catch(a){console.log(a)}};re(T.value?.data.all||[]);const D=u=>le(u,!0);H({title:e.value.title,description:e.value.seo.description,keywords:e.value.seo.keywords,author:"Théologie pour Tous",ogTitle:e.value.title,ogDescription:e.value.seo.description,ogImage:e.value.image.src,ogType:"article",ogUrl:e.value.seo.url,twitterCard:e.value.seo.card,twitterTitle:e.value.title,twitterDescription:e.value.seo.description,twitterImage:e.value.image.src}),J({htmlAttrs:{lang:e.value?.seo.lang||"fr"},link:[{rel:"canonical",href:e.value.seo.url}]});const g=M(()=>e.value&&U(e.value.slug)?{icon:"i-lucide-circle-check-big",color:"success",label:"Appris",variant:"subtle"}:v.value?.data?{icon:"i-lucide-circle-dashed",color:"secondary",label:"En cours",variant:"subtle"}:{icon:"i-lucide-flag",color:"warning",label:"Commencer le parcours",variant:"subtle"});return(u,a)=>{const d=X,P=Y,I=te,E=oe,N=Z,A=ne,V=se,q=ae,z=ee,L=K;return t(e)?(s(),m(L,{key:0},{default:l(()=>[i("img",{src:t(e).image.src,class:"w-full aspect-video rounded-b-xl max-h-[32rem] object-cover object-center"},null,8,ue),p(I,{title:t(e).title,description:t(e).description},{headline:l(()=>[i("div",de,[t(y)?(s(),_(b,{key:0},[t(k)==="success"?(s(),m(d,{key:0,icon:t(g).icon,color:t(g).color,label:t(g).label,variant:t(g).variant,size:"xs",onClick:a[0]||(a[0]=n=>B(t(e).slug))},null,8,["icon","color","label","variant"])):["idle","pending"].includes(t(k))?(s(),m(d,{key:1,color:"secondary",variant:"subtle",size:"xs",disabled:""},{default:l(()=>[p(P,{name:"i-lucide-loader-2",class:"animate-spin"})]),_:1})):r("",!0)],64)):r("",!0),i("time",me,C(new Date(t(e).date).toLocaleDateString("fr",{year:"numeric",month:"long",day:"numeric"})),1),a[1]||(a[1]=i("span",{class:"hidden lg:block text-muted"},"·",-1)),i("div",null,[(s(!0),_(b,null,$(t(e).tags,(n,O)=>(s(),_("span",{key:n,class:"text-warning-600 font-light"},[Q(C(n),1),O!==t(e).tags.length-1?(s(),_("span",pe,", ")):r("",!0)]))),128))])])]),default:l(()=>[i("div",_e,[t(e).biblical_references?.length?(s(),_("h3",fe," Références bibliques : ")):r("",!0),i("div",ge,[(s(!0),_(b,null,$(t(e).biblical_references,n=>(s(),m(d,{key:n,label:n,color:"secondary",variant:"subtle",size:"xs",to:D(n),target:"_blank"},null,8,["label","to"]))),128))])])]),_:1},8,["title","description"]),p(z,null,W({default:l(()=>[p(V,null,{default:l(()=>[t(e)?(s(),m(E,{key:0,value:t(e)},null,8,["value"])):r("",!0),t(x)?.length?(s(),m(N,{key:1})):r("",!0),p(A,{surround:t(x)},null,8,["surround"])]),_:1})]),_:2},[t(e)?.body?.toc?.links?.length?{name:"right",fn:l(()=>[p(q,{links:t(e).body.toc.links},null,8,["links"])]),key:"0"}:void 0]),1024)]),_:1})):r("",!0)}}});export{Te as default};
