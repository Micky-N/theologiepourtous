import{B as M,a5 as q,v as R,C as U,K as j,D as F,aU as H,z as c,f as _,H as s,w as r,E as O,h as u,g,d as b,I as S,L as G,F as B,M as v,t as D,Q as J,R as K,P as Q,e as o}from"#entry";import{_ as W,a as X}from"./CVgFCWlT.js";import{b as Y,_ as Z,a as ee}from"./BBkeP7wG.js";import{u as k}from"./B_Cg5Li1.js";import{q as te,a as se}from"./DuU9hUNe.js";import"./DJuYd3OA.js";import"./iik6CYzq.js";import"./C1OEmZiP.js";const oe=["src"],ae={class:"flex flex-col lg:flex-row items-start lg:items-center space-x-1"},ne={class:"text-muted"},re={key:0},le={class:"flex flex-col md:flex-row md:items-center gap-2 mt-4"},ie={key:0,class:"text-sm font-medium text-muted"},ce={class:"flex flex-wrap items-center gap-2"},ve=M({__name:"[slug]",async setup(ue){let l,h;const{loggedIn:L}=q(),d=R(),{data:e}=([l,h]=U(()=>k(d.path,()=>te("lessons").path(d.path).first(),"$jlyxFBwIyO")),l=await l,h(),l);if(!e.value)throw j({statusCode:404,statusMessage:"Lesson not found",fatal:!0});const{data:y,refresh:E}=k(d.path+"-progress",()=>$fetch(`/api/teaching/progress/${e.value?.theme}`,{method:"GET"}),{immediate:L.value}),{data:C}=([l,h]=U(()=>k("bible-books",()=>$fetch("/api/bible/books",{method:"GET"}))),l=await l,h(),l),{data:T}=k(`${d.path}-surround`,()=>se("lessons",d.path,{fields:["description"]}).where("theme","=",d.params.theme)),I=m=>{if(!y.value?.data)return!1;const t=y.value?.data.lessons;if(!t)return!1;const a=JSON.parse(t);return a.length&&a.includes(m)},x=async m=>{try{await $fetch(`/api/teaching/progress/${e.value?.theme}`,{method:"POST",body:{lesson:m}}),await E()}catch(t){console.log(t)}},N=m=>{let t=m.trim();if(!C.value)return"/bible";const a=t.match(/^(1|2|3)?\s?([^\d:]+)/);if(!a)return"/bible";const w=a[0].trim(),p=C.value?.data.all.find($=>$.name.toLowerCase()===w.toLowerCase());if(!p)return"/bible";if(t=t.replace(a[0],"").trim(),!t)return`/bible?book=${p.code}`;const i=t.match(/^(\d+)(?::([\d\-;]+))?$/);if(!i)return`/bible?book=${p.code}`;let f=`/bible?book=${p.code}`;return i[1]&&(f+=`&chapter=${i[1]}`),i[2]&&(f+=`&verse=${i[2]}`),f};return F({title:e.value.title,description:e.value.seo.description,keywords:e.value.seo.keywords,author:"Théologie pour Tous",ogTitle:e.value.title,ogDescription:e.value.seo.description,ogImage:e.value.image.src,ogType:"article",ogUrl:e.value.seo.url,twitterCard:e.value.seo.card,twitterTitle:e.value.title,twitterDescription:e.value.seo.description,twitterImage:e.value.image.src}),H({htmlAttrs:{lang:e.value?.seo.lang||"fr"},link:[{rel:"canonical",href:e.value.seo.url}]}),(m,t)=>{const a=G,w=W,p=Z,i=K,f=ee,$=X,P=Y,V=Q,z=O;return s(e)?(o(),c(z,{key:0},{default:r(()=>[u("img",{src:s(e).image.src,class:"w-full aspect-video rounded-b-xl max-h-[32rem] object-cover object-center"},null,8,oe),g(w,{title:s(e).title,description:s(e).description},{headline:r(()=>[u("div",ae,[I(s(e).slug)?(o(),c(a,{key:0,icon:"i-lucide-circle-check-big",size:"xs",color:"success",variant:"subtle",onClick:t[0]||(t[0]=n=>x(s(e).slug))},{default:r(()=>[...t[3]||(t[3]=[v(" Appris ",-1)])]),_:1})):s(y)?.data?(o(),c(a,{key:1,icon:"i-lucide-circle-dashed",size:"xs",color:"secondary",variant:"subtle",onClick:t[1]||(t[1]=n=>x(s(e).slug))},{default:r(()=>[...t[4]||(t[4]=[v(" En cours ",-1)])]),_:1})):(o(),c(a,{key:2,icon:"i-lucide-flag",size:"xs",color:"warning",variant:"subtle",onClick:t[2]||(t[2]=n=>x(s(e).slug))},{default:r(()=>[...t[5]||(t[5]=[v(" Commencer le parcours ",-1)])]),_:1})),u("time",ne,D(new Date(s(e).date).toLocaleDateString("fr",{year:"numeric",month:"long",day:"numeric"})),1),t[6]||(t[6]=u("span",{class:"hidden lg:block text-muted"},"·",-1)),u("div",null,[(o(!0),b(B,null,S(s(e).tags,(n,A)=>(o(),b("span",{key:n,class:"text-warning-600 font-light"},[v(D(n),1),A!==s(e).tags.length-1?(o(),b("span",re,", ")):_("",!0)]))),128))])])]),default:r(()=>[u("div",le,[s(e).biblical_references?.length?(o(),b("h3",ie," Références bibliques : ")):_("",!0),u("div",ce,[(o(!0),b(B,null,S(s(e).biblical_references,n=>(o(),c(a,{key:n,label:n,color:"secondary",variant:"subtle",size:"xs",to:N(n),target:"_blank"},null,8,["label","to"]))),128))])])]),_:1},8,["title","description"]),g(V,null,J({default:r(()=>[g($,null,{default:r(()=>[s(e)?(o(),c(p,{key:0,value:s(e)},null,8,["value"])):_("",!0),s(T)?.length?(o(),c(i,{key:1})):_("",!0),g(f,{surround:s(T)},null,8,["surround"])]),_:1})]),_:2},[s(e)?.body?.toc?.links?.length?{name:"right",fn:r(()=>[g(P,{links:s(e).body.toc.links},null,8,["links"])]),key:"0"}:void 0]),1024)]),_:1})):_("",!0)}}});export{ve as default};
