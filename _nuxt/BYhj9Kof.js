import{z as w,a0 as $,r as v,Z as k,G as h,I as B,e as o,w as p,h as l,H as V,d as u,f as x,g as S,O as N,t as d,N as P,bj as C}from"#entry";import{v as E}from"./ChZFRpQR.js";const U=["id"],j={class:"w-72 max-w-xs p-2"},G={key:0,class:"flex items-center gap-2 text-gray-600"},I={key:1,class:"text-sm text-red-600"},O={key:2,class:"space-y-1"},R={class:"text-xs text-gray-500"},F={key:0},L={class:"italic text-gray-800 leading-relaxed"},T=w({__name:"BiblicalReferencePopover",props:{verse:{}},setup(t){const{user:g}=$(),f=v(!1),m=v(!1),n=v(null),s=v(null),c=k("cache",()=>new Map);async function _(a){const e=E(a);console.log("Fetching verse:",e),e.version=e.version||g.value?.preferences.defaultVersion?.code||"LGS";const i=await $fetch(`/api/bible/verses/${e.book}/${e.chapter}/${e.verse}`,{method:"GET",query:{version:e.version}});if(!i.success)throw new Error("Erreur lors du chargement du verset.");const r=i.data;return{reference:`${r.book.name} ${r.chapter}:${r.verse}`,text:r.text,version:r.version.code}}async function y(){if(n.value=null,c.value.has(t.verse)){s.value=c.value.get(t.verse);return}m.value=!0,s.value=null;try{const a=await _(t.verse);c.value.set(t.verse,a),s.value=a}catch{n.value="Impossible de charger le verset."}finally{m.value=!1}}return h(f,a=>{a&&y()}),h(()=>t.verse,()=>{s.value=c.value.get(t.verse)??null,n.value=null}),(a,e)=>{const i=N,r=C;return o(),B(r,{open:f.value,"onUpdate:open":e[0]||(e[0]=b=>f.value=b),mode:"hover"},{content:p(()=>[l("div",j,[m.value?(o(),u("div",G,[S(i,{name:"i-heroicons-arrow-path-20-solid",class:"animate-spin"}),e[1]||(e[1]=l("span",null,"Chargement du verset…",-1))])):n.value?(o(),u("div",I,d(n.value),1)):s.value?(o(),u("div",O,[l("div",R,[P(d(s.value.reference),1),s.value.version?(o(),u("span",F," — "+d(s.value.version),1)):x("",!0)]),l("div",L,d(s.value.text),1)])):x("",!0)])]),default:p(()=>[l("a",{id:t.verse,class:"hover:underline"},[V(a.$slots,"default")],8,U)]),_:3},8,["open"])}}}),A=Object.assign(T,{__name:"BiblicalReferencePopover"});export{A as default};
