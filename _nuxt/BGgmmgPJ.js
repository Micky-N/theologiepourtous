import{y as ye,D as K,I as N,e as i,w as r,H as xe,n as ke,C as s,V as we,R as j,z as $e,a4 as Ce,r as a,o as Ue,G as O,a1 as T,a5 as Ne,g as l,f as P,a6 as Se,P as Ve,h as n,d as g,a7 as h,a8 as Me,a9 as Pe,F as G,K as H,O as De,t as c,M as Ee,N as q,aa as Ie,ab as Le,S as Be,ac as Te,_ as qe}from"#entry";import{_ as ze,a as Ae}from"./ChfH4k70.js";import{_ as Re}from"./B5BmDUTd.js";import{_ as Fe}from"./D_4Em1Od.js";import{_ as je}from"./CvsAtPMi.js";import{_ as Oe}from"./D5Npt56y.js";import{_ as Ge}from"./9VLIreS9.js";import{_ as He}from"./Cscn447a.js";import"./Dpy1dZNI.js";import"./BGeCMNnO.js";import"./C8liMDU-.js";import"./CiYoogra.js";const Ke={base:"animate-pulse rounded-md bg-elevated"},Qe={__name:"USkeleton",props:{as:{type:null,required:!1},class:{type:null,required:!1}},setup(D){const v=D,C=ye(),d=K(()=>j({extend:j(Ke),...C.ui?.skeleton||{}}));return(y,S)=>(i(),N(s(we),{as:D.as,"aria-busy":"true","aria-label":"loading","aria-live":"polite",role:"alert",class:ke(d.value({class:v.class}))},{default:r(()=>[xe(y.$slots,"default")]),_:3},8,["as","class"]))}},Je={class:"flex flex-col sm:flex-row gap-4 mb-6"},We={key:0,class:"space-y-4"},Xe={key:1,class:"text-center py-12"},Ye={key:2,class:"space-y-4"},Ze={class:"flex items-center justify-between"},et={class:"flex-1"},tt={class:"font-semibold text-lg text-gray-900 dark:text-white"},ot={class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},st={class:"flex items-center gap-2"},at={class:"space-y-3"},lt={class:"border-l-4 border-primary-500 pl-4 italic text-gray-700 dark:text-gray-300"},nt={class:"prose prose-sm dark:prose-invert max-w-none"},rt={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},it={key:0},ct={key:3,class:"flex justify-center mt-8"},ut={class:"flex gap-3 justify-end"},dt=$e({__name:"notes",setup(D){Ce({title:"Mes Notes",meta:[{name:"description",content:"Gérez vos notes personnelles sur les versets bibliques"},{name:"robots",content:"noindex,nofollow"}]});const v=a([]),C=a(!1),d=a(1),y=a(10),S=a(0),Q=K(()=>Math.ceil(S.value/y.value)),x=a(""),k=a(null),m=a(""),w=a(!1),f=a(!1),$=a(!1),U=a(null),_=a(null),E=a(!1),V=a(null),I=a([]),J=[{label:"Toutes les notes",value:null},{label:"Notes privées",value:"true"},{label:"Notes publiques",value:"false"}],W=a([]),L=a(void 0),M=a({title:"",content:"",verseId:void 0,isPrivate:!1}),B=(e,t)=>e.length<=t?e:e.substring(0,t)+"...",z=e=>(typeof e=="string"&&(e=new Date(e)),e.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})),X=Pe(async()=>{if(await p(),m.value.trim()===""||m.value.length<=3)return;d.value=1;const e=[];for(const t of v.value)(t.title?.toLowerCase().includes(m.value.toLowerCase())||t.content.toLowerCase().includes(m.value.toLowerCase()))&&e.push(t);v.value=e},500),p=async()=>{C.value=!0;try{const e=new URLSearchParams;e.append("limit",y.value.toString()),e.append("offset",((d.value-1)*y.value).toString()),x.value&&e.append("book",x.value),k.value!==null&&e.append("private",k.value);const t=await $fetch(`/api/bible/notes?${e.toString()}`);v.value=t.data.notes,S.value=t.data.pagination.total}catch(e){console.error("Erreur lors du chargement des notes:",e),T().add({title:"Erreur",description:"Impossible de charger les notes",color:"error"})}finally{C.value=!1}},Y=async()=>{try{const e=await $fetch("/api/bible/books");I.value=e.data.all.map(t=>({label:t.name,value:t.code})),I.value.unshift({label:"Tous les livres",value:null})}catch(e){console.error("Erreur lors du chargement des livres:",e)}},Z=async(e="")=>{try{const t=new URLSearchParams;e&&t.append("q",e),t.append("limit","50");const u=await $fetch(`/api/bible/search?${t.toString()}`);u.data&&u.data.verses&&(W.value=u.data.verses.map(b=>({label:`${b.book.name} ${b.chapter}:${b.verse} - ${B(b.text,60)}`,value:b.id})))}catch(t){console.error("Erreur lors du chargement des versets:",t)}},ee=()=>{_.value=null,M.value={title:"",content:"",verseId:void 0,isPrivate:!1},L.value=void 0,w.value=!0,Z()},A=e=>{_.value=e,M.value={title:e.title||"",content:e.content,verseId:void 0,isPrivate:e.isPrivate},f.value=!1,w.value=!0},R=e=>{U.value=e,f.value=!0},te=()=>{w.value=!1,_.value=null,M.value={title:"",content:"",verseId:void 0,isPrivate:!1},L.value=void 0},F=e=>{V.value=e,$.value=!0},oe=async()=>{if(V.value){E.value=!0;try{await $fetch(`/api/bible/notes/${V.value.id}`,{method:"DELETE"}),T().add({title:"Succès",description:"Note supprimée avec succès",color:"success"}),f.value&&(f.value=!1),$.value=!1,V.value=null,await p()}catch(e){console.error("Erreur lors de la suppression:",e),T().add({title:"Erreur",description:"Erreur lors de la suppression",color:"error"})}finally{E.value=!1}}},se=e=>[[{label:"Voir",icon:"i-heroicons-eye",onSelect:()=>R(e)}],[{label:"Modifier",icon:"i-heroicons-pencil",onSelect:()=>A(e)}],[{label:"Supprimer",icon:"i-heroicons-trash",onSelect:()=>F(e)}]];return Ue(()=>{p(),Y()}),O([x,k],()=>{d.value=1,p()}),O(L,e=>{e&&(M.value.verseId=e)}),(e,t)=>{const u=Ve,b=ze,ae=Re,le=Fe,ne=Me,re=Qe,ie=De,ce=Ee,ue=Ie,de=je,pe=Oe,ve=Ae,me=Se,fe=Be,_e=Ge,be=He,ge=Te,he=Ne;return i(),N(he,null,{default:r(()=>[l(fe,null,{default:r(()=>[l(me,null,{default:r(()=>[l(b,{title:"Mes Notes",description:"Gérez vos notes personnelles sur les versets bibliques"},{right:r(()=>[l(u,{icon:"i-heroicons-plus",label:"Nouvelle note",onClick:ee})]),_:1}),l(ve,null,{default:r(()=>[n("div",Je,[l(ae,{modelValue:s(x),"onUpdate:modelValue":t[0]||(t[0]=o=>h(x)?x.value=o:null),items:s(I),"label-key":"label","value-key":"value",placeholder:"Tous les livres",searchable:"",class:"flex-1",onChange:p},null,8,["modelValue","items"]),l(le,{modelValue:s(k),"onUpdate:modelValue":t[1]||(t[1]=o=>h(k)?k.value=o:null),items:J,"label-key":"label","value-key":"value",placeholder:"Toutes les notes",class:"flex-1 sm:flex-none",onChange:p},null,8,["modelValue"]),l(ne,{modelValue:s(m),"onUpdate:modelValue":t[2]||(t[2]=o=>h(m)?m.value=o:null),placeholder:"Rechercher dans les notes...",icon:"i-heroicons-magnifying-glass",class:"flex-1",onInput:s(X)},null,8,["modelValue","onInput"])]),s(C)?(i(),g("div",We,[(i(),g(G,null,H(3,o=>l(re,{key:o,class:"h-32 w-full"})),64))])):s(v).length===0?(i(),g("div",Xe,[l(ie,{name:"i-heroicons-document-text",class:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t[9]||(t[9]=n("p",{class:"text-gray-500 text-lg mb-4"}," Aucune note trouvée ",-1)),l(u,{to:"/bible",icon:"i-lucide-book-open-text",label:"Lire la Bible"})])):(i(),g("div",Ye,[(i(!0),g(G,null,H(s(v),o=>(i(),N(de,{key:o.id,class:"hover:shadow-lg transition-shadow cursor-pointer",onClick:pt=>R(o)},{header:r(()=>[n("div",Ze,[n("div",et,[n("h3",tt,c(o.title||"Note sans titre"),1),n("p",ot,c(o.book.name)+" "+c(o.verse.chapter)+":"+c(o.verse.verse)+" ("+c(o.verse.version.code)+") ",1)]),n("div",st,[l(ce,{color:o.isPrivate?"error":"success",size:"xs"},{default:r(()=>[q(c(o.isPrivate?"Privée":"Publique"),1)]),_:2},1032,["color"]),l(ue,{items:se(o)},{default:r(()=>[l(u,{icon:"i-heroicons-ellipsis-vertical",variant:"ghost",size:"sm",onClick:t[3]||(t[3]=Le(()=>{},["stop"]))})]),_:1},8,["items"])])])]),default:r(()=>[n("div",at,[n("blockquote",lt,' "'+c(B(o.verse.text,150))+'" ',1),n("div",nt,c(B(o.content,200)),1),n("div",rt,[n("span",null,"Créée le "+c(z(o.createdAt)),1),o.updatedAt!==o.createdAt?(i(),g("span",it," Modifiée le "+c(z(o.updatedAt)),1)):P("",!0)])])]),_:2},1032,["onClick"]))),128))])),s(Q)>1?(i(),g("div",ct,[l(pe,{modelValue:s(d),"onUpdate:modelValue":[t[4]||(t[4]=o=>h(d)?d.value=o:null),p],"page-count":s(y),total:s(S)},null,8,["modelValue","page-count","total"])])):P("",!0)]),_:1})]),_:1})]),_:1}),s(U)?(i(),N(_e,{key:0,open:s(f),"onUpdate:open":t[5]||(t[5]=o=>h(f)?f.value=o:null),notes:[s(U)],verse:s(U).verse,book:s(U).book,footer:!1,onEdit:A,onDelete:F},null,8,["open","notes","verse","book"])):P("",!0),s(_)?(i(),N(be,{key:1,open:s(w),"onUpdate:open":t[6]||(t[6]=o=>h(w)?w.value=o:null),note:s(_),verse:s(_).verse,book:s(_).book,onClose:te,onRefreshNote:p},null,8,["open","note","verse","book"])):P("",!0),l(ge,{open:s($),"onUpdate:open":t[8]||(t[8]=o=>h($)?$.value=o:null),title:"Supprimer la note"},{body:r(()=>[...t[10]||(t[10]=[n("p",{class:"text-gray-600 dark:text-gray-400"}," Êtes-vous sûr de vouloir supprimer cette note ? Cette action est irréversible. ",-1)])]),footer:r(()=>[n("div",ut,[l(u,{color:"neutral",variant:"soft",onClick:t[7]||(t[7]=o=>$.value=!1)},{default:r(()=>[...t[11]||(t[11]=[q(" Annuler ",-1)])]),_:1}),l(u,{color:"error",loading:s(E),onClick:oe},{default:r(()=>[...t[12]||(t[12]=[q(" Supprimer ",-1)])]),_:1},8,["loading"])])]),_:1},8,["open"])]),_:1})}}}),Ct=qe(dt,[["__scopeId","data-v-42638122"]]);export{Ct as default};
