import{B as te,r as v,a6 as oe,d as b,g as a,w as d,f as A,h as o,H as e,b5 as ae,J as j,F as H,I as Z,n as G,z as J,t as p,L as le,Z as ne,M as W,aZ as ke,e as c,_ as xe,D as he,v as $e,a as Ce,V as Y,C as se,P as Ve,Q as we,aW as Ue,aq as Re}from"#entry";import{_ as Be}from"./lF-cOGfW.js";import{_ as Se,a as je}from"./CVgFCWlT.js";import{_ as re}from"./g6Za9bgq.js";import{_ as ie}from"./C0CPpTht.js";import{_ as de}from"./Bj6CTjPb.js";import{_ as ze}from"./Dp9YWf1p.js";import"./Dcm9wb4e.js";import"./9v54ouTo.js";import"./DW03Qsmw.js";import"./BD63mw3m.js";const Ae={class:"bible-comparison"},Ne={class:"flex items-center justify-between"},Me={class:"text-xl font-bold text-gray-900 dark:text-white"},qe={key:0},Le={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Ie={class:"flex gap-2"},Oe={key:0,class:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg"},Ee={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Fe={class:"flex items-center gap-2 pt-6"},Pe={class:"sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 pb-2 mb-4 z-10"},Te={class:"flex items-center justify-between"},De={class:"font-semibold text-gray-900 dark:text-white"},Ge={class:"text-xs text-gray-500 dark:text-gray-400"},He={class:"verses-container space-y-3"},Ze={class:"flex items-start gap-2"},Je={key:0,class:"verse-number flex-shrink-0 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded-md min-w-[2rem] text-center"},Qe={class:"verse-actions opacity-0 group-hover:opacity-100 transition-opacity mt-2 flex gap-2"},We={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ke={class:"flex items-center justify-between"},Xe={class:"flex gap-2"},Ye={class:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400"},es={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ss=["onClick"],ts={class:"font-medium"},os={class:"text-sm text-gray-500"},as=te({__name:"BibleComparison",props:{book:{},chapter:{},verseRange:{},comparisons:{},availableVersions:{default:()=>[]},loading:{type:Boolean,default:!1}},emits:["close","addVersion","removeVersion","addBookmark","addNote"],setup(g,{emit:L}){const N=L,u=g,F=v(!1),k=v(!1),$=v("side-by-side"),C=v("normal"),V=v(!0),x=oe(),w=[{label:"Côte à côte",value:"side-by-side"},{label:"Vertical",value:"vertical"}],U=[{label:"Petit",value:"small"},{label:"Normal",value:"normal"},{label:"Grand",value:"large"},{label:"Très grand",value:"extra-large"}],z=h=>{u.comparisons.length<6&&(N("addVersion",h),k.value=!1)},m=h=>{N("removeVersion",h)},P=async(h,n)=>{const _=`${u.book.name} ${u.chapter}:${h.verse} (${n.code})
"${h.text}"`;try{await navigator.clipboard.writeText(_),x.add({title:"Verset copié",description:"Le verset a été copié dans le presse-papiers."})}catch(S){console.error("Erreur lors de la copie:",S),x.add({color:"error",title:"Erreur de copie",description:"Impossible de copier le verset."})}},i=()=>{const h=u.comparisons.map(M=>{const I=M.verses.map(B=>`${B.verse}. ${B.text}`).join(`
`);return`${M.version.name} (${M.version.code})
${I}`}).join(`

---

`),n=`${u.book.name} ${u.chapter}:${u.verseRange.start}${u.verseRange.end>u.verseRange.start?`-${u.verseRange.end}`:""}

${h}`,_=new Blob([n],{type:"text/plain"}),S=URL.createObjectURL(_),R=document.createElement("a");R.href=S,R.download=`${u.book.code}_${u.chapter}_${u.verseRange.start}-${u.verseRange.end}_comparison.txt`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(S)};return(h,n)=>{const _=le,S=re,R=ae,M=ie,I=ne,B=de,Q=ke;return c(),b("div",Ae,[a(B,null,{header:d(()=>[o("div",Ne,[o("div",null,[o("h2",Me,[W(" Comparaison : "+p(g.book.name)+" "+p(g.chapter)+":"+p(g.verseRange.start),1),g.verseRange.end>g.verseRange.start?(c(),b("span",qe,"-"+p(g.verseRange.end),1)):A("",!0)]),o("p",Le,p(g.comparisons.length)+" versions côte à côte ",1)]),o("div",Ie,[a(_,{icon:"i-lucide-settings",variant:"ghost",size:"sm",onClick:n[0]||(n[0]=l=>F.value=!e(F))}),a(_,{icon:"i-lucide-x",variant:"ghost",size:"sm",onClick:n[1]||(n[1]=l=>h.$emit("close"))})])])]),footer:d(()=>[o("div",Ke,[o("div",Xe,[a(_,{disabled:g.comparisons.length>=6,icon:"i-lucide-plus",label:"Ajouter version",variant:"outline",size:"sm",onClick:n[5]||(n[5]=l=>k.value=!0)},null,8,["disabled"]),a(_,{icon:"i-lucide-download",label:"Exporter",variant:"outline",size:"sm",onClick:i})]),o("div",Ye,[g.loading?(c(),J(I,{key:0,name:"i-svg-spinners-3-dots-fade",class:"w-4 h-4 text-gray-400"})):A("",!0),n[10]||(n[10]=o("span",null,"Maximum 6 versions simultanées",-1))])])]),default:d(()=>[e(F)?(c(),b("div",Oe,[n[8]||(n[8]=o("h3",{class:"font-medium text-gray-900 dark:text-white mb-3"}," Options d'affichage ",-1)),o("div",Ee,[a(R,{label:"Layout"},{default:d(()=>[a(S,{modelValue:e($),"onUpdate:modelValue":n[2]||(n[2]=l=>j($)?$.value=l:null),items:w,"label-key":"label","value-key":"value"},null,8,["modelValue"])]),_:1}),a(R,{label:"Taille du texte"},{default:d(()=>[a(S,{modelValue:e(C),"onUpdate:modelValue":n[3]||(n[3]=l=>j(C)?C.value=l:null),items:U,"label-key":"label","value-key":"value"},null,8,["modelValue"])]),_:1}),o("div",Fe,[a(M,{modelValue:e(V),"onUpdate:modelValue":n[4]||(n[4]=l=>j(V)?V.value=l:null),label:"Numéros de versets"},null,8,["modelValue"])])])])):A("",!0),o("div",{class:G(["grid gap-4",{"grid-cols-1":e($)==="vertical","grid-cols-1 md:grid-cols-2":e($)==="side-by-side"&&g.comparisons.length===2,"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":e($)==="side-by-side"&&g.comparisons.length>=3}])},[(c(!0),b(H,null,Z(g.comparisons,(l,O)=>(c(),b("div",{key:l.version.id,class:G(["version-column",{"!border-r-0 !pr-0":O!=0&&(O+1)%3===0,"border-r pr-4":O!=g.comparisons.length-1}])},[o("div",Pe,[o("div",Te,[o("div",null,[o("h3",De,p(l.version.name),1),o("p",Ge,p(l.version.code)+" • "+p(l.version.language),1)]),g.comparisons.length>2?(c(),J(_,{key:0,icon:"i-lucide-x",variant:"ghost",size:"xs",onClick:q=>m(l.version.id)},null,8,["onClick"])):A("",!0)])]),o("div",He,[(c(!0),b(H,null,Z(l.verses,q=>(c(),b("div",{key:`${l.version.id}-${q.id}`,class:G(["group verse-item",e(C)])},[o("div",Ze,[e(V)?(c(),b("span",Je,p(q.verse),1)):A("",!0),o("p",{class:G(["verse-text leading-relaxed text-gray-800 dark:text-gray-200",{"text-sm":e(C)==="small","text-base":e(C)==="normal","text-lg":e(C)==="large","text-xl":e(C)==="extra-large"}])},p(q.text),3)]),o("div",Qe,[a(_,{title:"Copier le verset",icon:"i-lucide-copy",variant:"ghost",size:"xs",onClick:ee=>P(q,l.version)},null,8,["onClick"])])],2))),128))]),l.verses.length===0?(c(),b("div",We,[a(I,{name:"i-lucide-book-x",class:"w-8 h-8 mx-auto mb-2"}),n[9]||(n[9]=o("p",null," Aucun verset trouvé pour cette version ",-1))])):A("",!0)],2))),128))],2)]),_:1}),a(Q,{open:e(k),"onUpdate:open":n[7]||(n[7]=l=>j(k)?k.value=l:null),title:"Ajouter une version",description:"Sélectionnez une version à ajouter à la comparaison"},{body:d(()=>[o("div",es,[(c(!0),b(H,null,Z(g.availableVersions,l=>(c(),b("div",{key:l.id,class:"p-3 border border-gray-200 dark:border-gray-700 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",onClick:O=>z(l)},[o("div",ts,p(l.name),1),o("div",os,p(l.code)+" • "+p(l.language),1)],8,ss))),128))])]),footer:d(()=>[a(_,{label:"Annuler",variant:"ghost",onClick:n[6]||(n[6]=l=>k.value=!1)})]),_:1},8,["open"])])}}}),ls=Object.assign(xe(as,[["__scopeId","data-v-0a015808"]]),{__name:"BibleComparison"}),ns={key:0,class:"border-t dark:border-gray-800 pt-4"},rs={class:"space-y-1"},is={class:"truncate"},ds={class:"font-medium"},cs={class:"text-xs text-gray-500 dark:text-gray-400 ml-1"},us={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ms={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vs={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ps=["onClick"],gs={class:"flex items-center gap-3"},bs={class:"font-medium text-gray-900 dark:text-white"},fs={class:"text-xs text-gray-500 dark:text-gray-400"},ys={class:"flex items-center flex-row-reverse justify-between pt-4"},_s={key:1},js=te({__name:"compare",async setup(g){let L,N;he({title:"Comparaison de versions bibliques",ogTitle:"Comparaison de versions bibliques",description:"Comparez différentes versions de la Bible",ogDescription:"Comparez différentes versions de la Bible"});const u=$e(),F=Ce(),k=v([]),$=v(!1),C=v(!1),V=v(""),x=v(void 0),w=v(null),U=v(1),z=v(null),m=v([]),P=v([]),i=v(null),h=Y(()=>P.value.find(s=>s.code===x.value)),n=Y(()=>x.value&&w.value&&U.value&&m.value.length>=2&&m.value.length<=6),_=Y(()=>k.value.filter(s=>!i.value?.comparisons.some(t=>t.version.id===s.id))),S=()=>{const s=(u.query.verses||"").split("-");if(x.value=u.query.book||void 0,w.value=u.query.chapter?parseInt(u.query.chapter):null,U.value=s.length>0?parseInt(s[0]):1,z.value=s.length>1?parseInt(s[1]):null,k.value.length>0){const t=(u.query.versions||"LSG,S21").split(","),f=k.value.filter(y=>t.includes(y.code)).map(y=>y.id);f.length>=2&&(m.value=f)}},R=(s,t)=>{t===!0?m.value.includes(s)||m.value.push(s):m.value=m.value.filter(y=>y!==s)},M=async()=>{try{C.value=!0;const s=await $fetch("/api/bible/books");P.value=s.data?.all}catch(s){V.value="Erreur lors du chargement des livres",console.error(s)}finally{C.value=!1}},I=async()=>{try{const s=await $fetch("/api/bible/versions");k.value=s.data||s}catch(s){V.value="Erreur lors du chargement des versions",console.error(s)}},B=async()=>{if(n.value)try{V.value="",$.value=!0;const s=h.value,t=w.value,f=U.value,y=z.value||f;if(!s){V.value="Veuillez sélectionner un livre";return}const T=await $fetch("/api/bible/compare",{method:"POST",body:{bookId:s.id,chapter:t,verseStart:f,verseEnd:y,versions:m.value}});i.value=T.data}catch(s){V.value=s?.message||"Erreur lors de la comparaison",console.error(s)}finally{$.value=!1}},Q=async()=>{if(Object.keys(u.query).length>0)return await F.push("/bible/compare");i.value=null,x.value=void 0,w.value=null,m.value=k.value.filter(s=>["LSG","S21"].includes(s.code)).map(s=>s.id),U.value=1,z.value=null,V.value=""},l=async s=>{if(!i.value)return;const t={version:s,verses:[{id:0,chapter:i.value.chapter,verse:i.value.verseRange.start,text:"Chargement...",createdAt:new Date,versionId:s.id,bookId:i.value.book.id}]};i.value.comparisons.push(t),m.value.push(s.id),await B()},O=s=>{i.value&&(i.value.comparisons=i.value.comparisons.filter(t=>t.version.id!==s),m.value=m.value.filter(t=>t!==s))},q=s=>{const t=oe();(async()=>{try{const f=await $fetch("/api/bible/bookmarks",{method:"POST",body:{verseId:s.id}});t.add({title:"Favori ajouté",description:f.message||"Le verset a été ajouté à vos favoris."}),i.value&&await B()}catch(f){const y=f?.statusCode||f?.response?.status,T=f?.statusMessage||f?.data?.message||f?.message;t.add({color:"error",title:y===401?"Connexion requise":"Erreur",description:y===409?"Ce verset est déjà dans vos favoris.":T||"Impossible d’ajouter le favori."})}})()},ee=s=>{K.value=s,E.value=!0},E=v(!1),K=v(null),ce=async()=>{i.value&&await B()};return[L,N]=se(()=>Promise.all([M(),I()])),await L,N(),S(),[L,N]=se(()=>B()),await L,N(),(s,t)=>{const f=ne,y=le,T=Be,ue=Se,me=re,D=ae,X=Ue,ve=ie,pe=de,ge=ls,be=je,fe=Ve,ye=ze;return c(),b("div",null,[a(fe,null,{left:d(()=>[a(T,null,{top:d(()=>[a(y,{to:"/bible",color:"secondary",variant:"ghost",class:"w-full justify-start mb-4"},{leading:d(()=>[a(f,{name:"i-lucide-arrow-left"})]),default:d(()=>[t[8]||(t[8]=W(" Retour à la Bible ",-1))]),_:1}),e(i)?(c(),b("div",ns,[t[9]||(t[9]=o("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Versions disponibles ",-1)),o("div",rs,[(c(!0),b(H,null,Z(e(_),r=>(c(),J(y,{key:r.id,size:"sm",color:"secondary",variant:"soft",class:"w-full justify-start",disabled:e($)||e(m).length===6,onClick:_e=>l(r)},{default:d(()=>[o("div",is,[o("span",ds,p(r.name),1),o("span",cs,"("+p(r.code)+")",1)])]),_:2},1032,["disabled","onClick"]))),128))])])):A("",!0)]),_:1})]),default:d(()=>[a(ue,{title:"Comparaison de versions bibliques",description:"Comparez différentes versions de la Bible sur un même passage."},we({_:2},[e(i)?{name:"right",fn:d(()=>[a(y,{color:"secondary",variant:"ghost",icon:"i-lucide-x",onClick:t[0]||(t[0]=r=>Q())},{default:d(()=>[...t[10]||(t[10]=[W(" Fermer ",-1)])]),_:1})]),key:"0"}:void 0]),1024),a(be,null,{default:d(()=>[e(i)?(c(),b("div",_s,[a(ge,{book:e(i).book,chapter:e(i).chapter,"verse-range":e(i).verseRange,comparisons:e(i).comparisons,"available-versions":e(_),loading:e($),onClose:Q,onAddVersion:l,onRemoveVersion:O,onAddBookmark:q,onAddNote:ee},null,8,["book","chapter","verse-range","comparisons","available-versions","loading"])])):(c(),J(pe,{key:0},{header:d(()=>[...t[11]||(t[11]=[o("h3",{class:"text-lg font-medium"}," Sélectionner le passage à comparer ",-1)])]),default:d(()=>[o("form",{class:"space-y-6",onSubmit:Re(B,["prevent"])},[o("div",us,[a(D,{label:"Livre"},{default:d(()=>[a(me,{modelValue:e(x),"onUpdate:modelValue":t[1]||(t[1]=r=>j(x)?x.value=r:null),items:e(P),loading:e(C),"label-key":"name","value-key":"code",placeholder:"Sélectionner un livre",searchable:"","search-placeholder":"Rechercher un livre...",class:"max-w-52 w-full"},null,8,["modelValue","items","loading"])]),_:1}),a(D,{label:"Chapitre"},{default:d(()=>[a(X,{modelValue:e(w),"onUpdate:modelValue":t[2]||(t[2]=r=>j(w)?w.value=r:null),modelModifiers:{number:!0},type:"number",min:"1",max:e(h)?.chapterCount||150,placeholder:"Numéro de chapitre",disabled:!e(x),class:"max-w-52 w-full"},null,8,["modelValue","max","disabled"])]),_:1})]),o("div",ms,[a(D,{label:"Verset de début"},{default:d(()=>[a(X,{modelValue:e(U),"onUpdate:modelValue":t[3]||(t[3]=r=>j(U)?U.value=r:null),modelModifiers:{number:!0},type:"number",min:"1",placeholder:"1",disabled:!e(x)||!e(w),class:"max-w-52 w-full"},null,8,["modelValue","disabled"])]),_:1}),a(D,{label:"Verset de fin (optionnel)"},{default:d(()=>[a(X,{modelValue:e(z),"onUpdate:modelValue":t[4]||(t[4]=r=>j(z)?z.value=r:null),modelModifiers:{number:!0},type:"number",min:e(U)||1,placeholder:"Même verset",disabled:!e(x)||!e(w),class:"max-w-52 w-full"},null,8,["modelValue","min","disabled"])]),_:1})]),a(D,{label:"Versions à comparer",required:"",description:`${e(m).length} version(s) sélectionnée(s) (minimum 2, maximum 6)`},{default:d(()=>[o("div",vs,[(c(!0),b(H,null,Z(e(k),r=>(c(),b("div",{key:r.id,class:G(["p-3 rounded-lg border transition-colors cursor-pointer",e(m).includes(r.id)?"bg-primary-50 dark:bg-primary-950 border-primary-200 dark:border-primary-800":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800"]),onClick:_e=>R(r.id,!e(m).includes(r.id))},[o("div",gs,[a(ve,{"model-value":e(m).includes(r.id),disabled:e(m).length>=6&&!e(m).includes(r.id)},null,8,["model-value","disabled"]),o("div",null,[o("div",bs,p(r.name),1),o("div",fs,p(r.code)+" • "+p(r.language),1)])])],10,ps))),128))])]),_:1},8,["description"]),o("div",ys,[a(y,{type:"submit",loading:e($),disabled:!e(n),color:"primary"},{default:d(()=>[...t[12]||(t[12]=[W(" Démarrer la comparaison ",-1)])]),_:1},8,["loading","disabled"])])],32)]),_:1}))]),_:1})]),_:1}),e(i)&&e(K)?(c(),J(ye,{key:0,open:e(E),"onUpdate:open":t[5]||(t[5]=r=>j(E)?E.value=r:null),verse:e(K),book:e(i).book,onClose:t[6]||(t[6]=r=>E.value=!1),onRefreshNote:t[7]||(t[7]=()=>{E.value=!1,ce()})},null,8,["open","verse","book"])):A("",!0)])}}});export{js as default};
